<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—æŠ€èƒ½ä¼ æ‰¿ - äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* æŠ€èƒ½ä¼ æ‰¿ç‰¹å®šæ ·å¼ */
        .skill-wizard {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .skill-icon-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            margin: 0 auto 24px;
            border: 4px solid white;
            box-shadow: var(--shadow-lg);
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .category-card {
            padding: 20px;
            text-align: center;
            background: white;
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-300);
            box-shadow: var(--shadow-md);
        }
        
        .category-card.selected {
            background: var(--primary-50);
            border-color: var(--primary-500);
            box-shadow: var(--shadow-md);
        }
        
        .category-icon {
            font-size: 32px;
            margin-bottom: 12px;
            color: var(--primary-600);
        }
        
        .difficulty-slider {
            width: 100%;
            height: 8px;
            margin: 20px 0;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
            border-radius: 4px;
            outline: none;
        }
        
        .difficulty-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-500);
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }
        
        .difficulty-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            color: var(--neutral-600);
            font-size: 14px;
        }
        
        .rating-stars {
            display: flex;
            gap: 8px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .star {
            font-size: 32px;
            color: var(--neutral-300);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .star.active {
            color: #FFD700;
        }
        
        .step-builder {
            margin: 24px 0;
        }
        
        .step-item {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--secondary-400);
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .step-number {
            width: 36px;
            height: 36px;
            background: var(--secondary-500);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-actions {
            display: flex;
            gap: 8px;
        }
        
        .tool-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--neutral-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .memory-input {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--neutral-50);
            border-radius: var(--radius-md);
        }
        
        .memory-content {
            flex: 1;
        }
        
        .skill-preview {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-top: 32px;
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .preview-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .preview-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: var(--primary-600);
            flex-shrink: 0;
        }
        
        .preview-info h2 {
            color: white;
            margin-bottom: 4px;
        }
        
        .preview-category {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .preview-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 24px 0;
        }
        
        .preview-stat {
            text-align: center;
            flex: 1;
            min-width: 100px;
        }
        
        .preview-stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .preview-stat-label {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .preview-steps {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .preview-steps h4 {
            color: white;
            margin-bottom: 16px;
        }
        
        .skill-network {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: var(--radius-lg);
            margin: 24px 0;
            position: relative;
            overflow: hidden;
        }
        
        .network-node {
            position: absolute;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--primary-500);
        }
        
        .network-line {
            position: absolute;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            transform-origin: left center;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .skill-wizard {
                padding: 16px;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .step-item {
                flex-direction: column;
                gap: 12px;
            }
            
            .step-actions {
                align-self: flex-end;
            }
            
            .preview-header {
                flex-direction: column;
                text-align: center;
            }
            
            .preview-stats {
                flex-direction: column;
                gap: 16px;
            }
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* ç‰¹æ®Šæ ·å¼ */
        .heritage-timeline {
            margin: 24px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .heritage-timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--accent-400), var(--secondary-400));
        }
        
        .heritage-item {
            position: relative;
            margin-bottom: 24px;
            padding: 16px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--accent-400);
        }
        
        .heritage-item:before {
            content: '';
            position: absolute;
            left: -30px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-500);
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--accent-200);
        }
        
        .heritage-generation {
            font-weight: bold;
            color: var(--accent-600);
            margin-bottom: 4px;
        }
        
        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--neutral-800);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* æŠ€èƒ½æŒæ¡è¿›åº¦ */
        .mastery-progress {
            margin: 24px 0;
        }
        
        .mastery-bar {
            height: 12px;
            background: var(--neutral-200);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .mastery-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-400), var(--accent-400));
            border-radius: 6px;
            transition: width 1s ease;
        }
        
        .mastery-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--neutral-600);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="../index.html" class="navbar-brand">
                <div class="navbar-logo">ğŸ”§</div>
                <span>äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°</span>
            </a>
            <ul class="navbar-menu">
                <li class="navbar-item">
                    <a href="../index.html" class="navbar-link">é¦–é¡µ</a>
                </li>
                <li class="navbar-item">
                    <a href="../exercises/photo-analyzer.html" class="navbar-link">ç…§ç‰‡åˆ†æ</a>
                </li>
                <li class="navbar-item">
                    <a href="../exercises/character-explorer.html" class="navbar-link">è§’è‰²æ¢ç´¢</a>
                </li>
                <li class="navbar-item">
                    <a href="../exercises/skill-heritage.html" class="navbar-link active">æŠ€èƒ½ä¼ æ‰¿</a>
                </li>
                <li class="navbar-item">
                    <a href="../dashboard.html" class="navbar-link">ä»ªè¡¨æ¿</a>
                </li>
            </ul>
            <div class="navbar-actions">
                <button class="btn btn-primary btn-sm" onclick="saveSkill()">
                    <i class="fas fa-save"></i> ä¿å­˜
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- å‘å¯¼å¼å¯¼èˆª -->
        <div class="wizard">
            <div class="wizard-steps">
                <div class="wizard-step active" data-step="1">
                    <div class="wizard-step-number">1</div>
                    <div class="wizard-step-label">æŠ€èƒ½è¯†åˆ«</div>
                </div>
                <div class="wizard-step" data-step="2">
                    <div class="wizard-step-number">2</div>
                    <div class="wizard-step-label">æŠ€èƒ½è¯¦è§£</div>
                </div>
                <div class="wizard-step" data-step="3">
                    <div class="wizard-step-number">3</div>
                    <div class="wizard-step-label">ä¼ æ‰¿è„‰ç»œ</div>
                </div>
                <div class="wizard-step" data-step="4">
                    <div class="wizard-step-number">4</div>
                    <div class="wizard-step-label">å­¦ä¹ æŒæ¡</div>
                </div>
                <div class="wizard-step" data-step="5">
                    <div class="wizard-step-number">5</div>
                    <div class="wizard-step-label">å®Œæˆè®°å½•</div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="skill-wizard">
            <div class="wizard-content">
                <!-- æ­¥éª¤1ï¼šæŠ€èƒ½è¯†åˆ« -->
                <div class="wizard-step-content active" id="step1">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ” æŠ€èƒ½è¯†åˆ«</h3>
                            <p class="card-subtitle">è®©æˆ‘ä»¬ä»è¯†åˆ«ä¸€é¡¹ç‰¹åˆ«çš„å®¶æ—æŠ€èƒ½å¼€å§‹</p>
                        </div>
                        <div class="card-body">
                            <!-- æŠ€èƒ½å›¾æ ‡é€‰æ‹© -->
                            <div class="text-center mb-8">
                                <div class="skill-icon-large" id="skillIconDisplay" onclick="showIconOptions()">
                                    ğŸ”§
                                </div>
                                <p class="text-sm text-gray-600">ç‚¹å‡»å›¾æ ‡é€‰æ‹©æŠ€èƒ½ç±»å‹</p>
                                
                                <div class="mt-4" id="iconOptions" style="display: none;">
                                    <div class="flex flex-wrap justify-center gap-3">
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸ”§')">ğŸ”§</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸ‘¨â€ğŸ³')">ğŸ‘¨â€ğŸ³</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸ§µ')">ğŸ§µ</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸ¨')">ğŸ¨</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸŒ±')">ğŸŒ±</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸ“š')">ğŸ“š</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸµ')">ğŸµ</div>
                                        <div class="text-3xl cursor-pointer p-3 rounded-lg hover:bg-gray-100" onclick="selectIcon('ğŸ’Š')">ğŸ’Š</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æŠ€èƒ½åç§° -->
                            <div class="form-group">
                                <label class="form-label" for="skillName">æŠ€èƒ½åç§°</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="skillName" 
                                       placeholder="è¯·è¾“å…¥æŠ€èƒ½åç§°ï¼ˆå¦‚ï¼šä¼ ç»Ÿæœ¨å·¥ã€å®¶å¸¸èœçƒ¹é¥ªï¼‰"
                                       value="">
                            </div>
                            
                            <!-- æŠ€èƒ½ç±»åˆ« -->
                            <div class="form-group">
                                <label class="form-label">æŠ€èƒ½ç±»åˆ«</label>
                                <div class="category-grid">
                                    <div class="category-card" data-category="craft">
                                        <div class="category-icon">ğŸ”¨</div>
                                        <div>æ‰‹å·¥è‰º</div>
                                    </div>
                                    <div class="category-card" data-category="cooking">
                                        <div class="category-icon">ğŸ‘¨â€ğŸ³</div>
                                        <div>çƒ¹é¥ªæŠ€è‰º</div>
                                    </div>
                                    <div class="category-card" data-category="sewing">
                                        <div class="category-icon">ğŸ§µ</div>
                                        <div>ç¼çº«ç¼–ç»‡</div>
                                    </div>
                                    <div class="category-card" data-category="art">
                                        <div class="category-icon">ğŸ¨</div>
                                        <div>è‰ºæœ¯åˆ›ä½œ</div>
                                    </div>
                                    <div class="category-card" data-category="garden">
                                        <div class="category-icon">ğŸŒ±</div>
                                        <div>å›­è‰ºç§æ¤</div>
                                    </div>
                                    <div class="category-card" data-category="knowledge">
                                        <div class="category-icon">ğŸ“š</div>
                                        <div>ä¼ ç»ŸçŸ¥è¯†</div>
                                    </div>
                                    <div class="category-card" data-category="music">
                                        <div class="category-icon">ğŸµ</div>
                                        <div>éŸ³ä¹æŠ€è‰º</div>
                                    </div>
                                    <div class="category-card" data-category="health">
                                        <div class="category-icon">ğŸ’Š</div>
                                        <div>å¥åº·å…»ç”Ÿ</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æŠ€èƒ½æ¥æº -->
                            <div class="form-group">
                                <label class="form-label" for="skillSource">æŠ€èƒ½æ¥æº</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="skillSource" 
                                       placeholder="è¿™é¡¹æŠ€èƒ½æ¥è‡ªå“ªä½å®¶äººæˆ–ä¼ æ‰¿è‡ªå“ªé‡Œï¼Ÿ"
                                       value="">
                            </div>
                            
                            <!-- æŠ€èƒ½ç®€ä»‹ -->
                            <div class="form-group">
                                <label class="form-label" for="skillDescription">æŠ€èƒ½ç®€ä»‹</label>
                                <textarea class="form-control" 
                                          id="skillDescription" 
                                          rows="4"
                                          placeholder="ç®€è¦æè¿°è¿™é¡¹æŠ€èƒ½çš„ç‰¹ç‚¹ã€ç”¨é€”å’Œæ„ä¹‰..."></textarea>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-8">
                                <button class="btn btn-outline" disabled>
                                    ä¸Šä¸€æ­¥
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(2)">
                                    ä¸‹ä¸€æ­¥ï¼šæŠ€èƒ½è¯¦è§£
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤2ï¼šæŠ€èƒ½è¯¦è§£ -->
                <div class="wizard-step-content" id="step2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“ æŠ€èƒ½è¯¦è§£</h3>
                            <p class="card-subtitle">è¯¦ç»†è®°å½•è¿™é¡¹æŠ€èƒ½çš„è¦ç‚¹å’Œæ­¥éª¤</p>
                        </div>
                        <div class="card-body">
                            <!-- éš¾åº¦è¯„ä¼° -->
                            <div class="form-group">
                                <label class="form-label">æŠ€èƒ½éš¾åº¦è¯„ä¼°</label>
                                <div class="tooltip">
                                    <p class="text-sm text-gray-600 mb-3">è¯·è¯„ä¼°æŒæ¡è¿™é¡¹æŠ€èƒ½çš„ç›¸å¯¹éš¾åº¦</p>
                                    <span class="tooltip-text">è€ƒè™‘å­¦ä¹ æ—¶é—´ã€å¤æ‚ç¨‹åº¦ã€æ‰€éœ€èµ„æºç­‰å› ç´ è¿›è¡Œè¯„ä¼°</span>
                                </div>
                                
                                <input type="range" 
                                       min="1" 
                                       max="5" 
                                       value="3" 
                                       class="difficulty-slider" 
                                       id="difficultySlider">
                                
                                <div class="difficulty-labels">
                                    <span>ç®€å•</span>
                                    <span>ä¸­ç­‰</span>
                                    <span>å›°éš¾</span>
                                </div>
                                
                                <div class="mt-2 text-center">
                                    <span class="font-semibold text-primary-600" id="difficultyText">ä¸­ç­‰éš¾åº¦</span>
                                </div>
                            </div>
                            
                            <!-- é‡è¦æ€§è¯„ä¼° -->
                            <div class="form-group">
                                <label class="form-label">ä¼ æ‰¿é‡è¦æ€§</label>
                                <p class="text-sm text-gray-600 mb-3">æ‚¨è®¤ä¸ºè¿™é¡¹æŠ€èƒ½å¯¹å®¶æ—ä¼ æ‰¿çš„é‡è¦æ€§å¦‚ä½•ï¼Ÿ</p>
                                
                                <div class="rating-stars">
                                    <div class="star" data-value="1">â˜†</div>
                                    <div class="star" data-value="2">â˜†</div>
                                    <div class="star" data-value="3">â˜†</div>
                                    <div class="star" data-value="4">â˜†</div>
                                    <div class="star" data-value="5">â˜†</div>
                                </div>
                                
                                <div class="mt-2 text-center">
                                    <span class="font-semibold text-primary-600" id="importanceText">ä¸€èˆ¬é‡è¦</span>
                                </div>
                            </div>
                            
                            <!-- è¯¦ç»†æ­¥éª¤ -->
                            <div class="form-group">
                                <label class="form-label">è¯¦ç»†æ­¥éª¤ä¸æ–¹æ³•</label>
                                <p class="text-sm text-gray-600 mb-3">è®°å½•å­¦ä¹ è¿™é¡¹æŠ€èƒ½çš„å…·ä½“æ­¥éª¤å’Œæ–¹æ³•</p>
                                
                                <div class="step-builder" id="stepBuilder">
                                    <div class="step-item">
                                        <div class="step-number">1</div>
                                        <div class="step-content">
                                            <textarea class="form-control" 
                                                      placeholder="ç¬¬ä¸€æ­¥ï¼šæè¿°è¿™ä¸ªæ­¥éª¤çš„å…·ä½“åšæ³•..."
                                                      rows="2"></textarea>
                                        </div>
                                        <div class="step-actions">
                                            <button class="btn btn-sm btn-outline text-gray-600" onclick="removeStep(this)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline" onclick="addStep()">
                                        <i class="fas fa-plus mr-2"></i> æ·»åŠ æ­¥éª¤
                                    </button>
                                </div>
                            </div>
                            
                            <!-- å·¥å…·ä¸ææ–™ -->
                            <div class="form-group">
                                <label class="form-label">æ‰€éœ€å·¥å…·ä¸ææ–™</label>
                                <div class="tooltip">
                                    <p class="text-sm text-gray-600 mb-3">è®°å½•å­¦ä¹ å’Œå®è·µè¿™é¡¹æŠ€èƒ½éœ€è¦çš„å·¥å…·å’Œææ–™</p>
                                    <span class="tooltip-text">åˆ—å‡ºå…·ä½“çš„å·¥å…·ã€ææ–™ã€è®¾å¤‡ç­‰ï¼Œå¯ä»¥åŒ…æ‹¬æ›¿ä»£å“å»ºè®®</span>
                                </div>
                                
                                <div id="toolsContainer">
                                    <div class="tool-card">
                                        <div>
                                            <input type="text" 
                                                   class="form-control form-control-sm" 
                                                   placeholder="å·¥å…·/ææ–™åç§°"
                                                   style="border: none; padding: 0; background: transparent;">
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline text-gray-600" onclick="removeTool(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline btn-sm" onclick="addTool()">
                                        <i class="fas fa-plus mr-2"></i> æ·»åŠ å·¥å…·
                                    </button>
                                </div>
                            </div>
                            
                            <!-- æŠ€å·§ä¸ç§˜è¯€ -->
                            <div class="form-group">
                                <label class="form-label" for="skillTips">æŠ€å·§ä¸ç§˜è¯€</label>
                                <textarea class="form-control" 
                                          id="skillTips" 
                                          rows="4"
                                          placeholder="è®°å½•ç‰¹åˆ«çš„æŠ€å·§ã€ç§˜è¯€ã€æ³¨æ„äº‹é¡¹æˆ–å¸¸è§é—®é¢˜è§£å†³æ–¹æ³•..."></textarea>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-8">
                                <button class="btn btn-outline" onclick="prevStep(1)">
                                    ä¸Šä¸€æ­¥ï¼šæŠ€èƒ½è¯†åˆ«
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(3)">
                                    ä¸‹ä¸€æ­¥ï¼šä¼ æ‰¿è„‰ç»œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤3ï¼šä¼ æ‰¿è„‰ç»œ -->
                <div class="wizard-step-content" id="step3">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ§¬ ä¼ æ‰¿è„‰ç»œ</h3>
                            <p class="card-subtitle">æ¢ç´¢è¿™é¡¹æŠ€èƒ½åœ¨å®¶æ—ä¸­çš„ä¼ æ‰¿å†å²</p>
                        </div>
                        <div class="card-body">
                            <!-- ä¼ æ‰¿ç½‘ç»œå¯è§†åŒ– -->
                            <div class="skill-network" id="skillNetwork">
                                <!-- ç½‘ç»œèŠ‚ç‚¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            
                            <!-- ä¼ æ‰¿æ—¶é—´çº¿ -->
                            <div class="form-group">
                                <label class="form-label">ä¼ æ‰¿å†å²æ—¶é—´çº¿</label>
                                <p class="text-sm text-gray-600 mb-3">è®°å½•è¿™é¡¹æŠ€èƒ½åœ¨å®¶æ—ä¸­çš„ä¼ æ‰¿å†ç¨‹</p>
                                
                                <div class="heritage-timeline" id="heritageTimeline">
                                    <div class="heritage-item">
                                        <div class="heritage-generation">ç¬¬ä¸€ä»£ï¼šæ›¾ç¥–çˆ¶è¾ˆ</div>
                                        <div>æŠ€èƒ½èµ·æºï¼Œå¯èƒ½æ¥è‡ªå®¶æ—ä¼ ç»Ÿæˆ–ç‰¹å®šå¸ˆå‚…</div>
                                    </div>
                                    <div class="heritage-item">
                                        <div class="heritage-generation">ç¬¬äºŒä»£ï¼šç¥–çˆ¶è¾ˆ</div>
                                        <div>æŠ€èƒ½å‘å±•ä¸å®Œå–„ï¼Œå¯èƒ½å¢åŠ äº†ä¸ªäººç‰¹è‰²</div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline btn-sm" onclick="addHeritageItem()">
                                        <i class="fas fa-plus mr-2"></i> æ·»åŠ ä¼ æ‰¿èŠ‚ç‚¹
                                    </button>
                                </div>
                            </div>
                            
                            <!-- å…³é”®ä¼ æ‰¿è®°å¿† -->
                            <div class="form-group">
                                <label class="form-label">å…³é”®ä¼ æ‰¿è®°å¿†</label>
                                <p class="text-sm text-gray-600 mb-3">è®°å½•ä¸è¿™é¡¹æŠ€èƒ½ä¼ æ‰¿ç›¸å…³çš„ç‰¹åˆ«æ•…äº‹æˆ–è®°å¿†</p>
                                
                                <div id="memoriesContainer">
                                    <div class="memory-input">
                                        <div class="memory-content">
                                            <textarea class="form-control" 
                                                      placeholder="æè¿°ä¸€ä¸ªä¸æŠ€èƒ½ä¼ æ‰¿ç›¸å…³çš„ç‰¹åˆ«è®°å¿†æˆ–æ•…äº‹..."
                                                      rows="3"></textarea>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline text-gray-600" onclick="removeMemory(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline btn-sm" onclick="addMemory()">
                                        <i class="fas fa-plus mr-2"></i> æ·»åŠ è®°å¿†
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ä¼ æ‰¿ä»·å€¼è§‚ -->
                            <div class="form-group">
                                <label class="form-label">ä¼ æ‰¿çš„ä»·å€¼è§‚</label>
                                <p class="text-sm text-gray-600 mb-3">è¿™é¡¹æŠ€èƒ½ä¼ é€’äº†å“ªäº›é‡è¦çš„å®¶æ—ä»·å€¼è§‚ï¼Ÿ</p>
                                
                                <div class="flex flex-wrap gap-2 mb-3">
                                    <span class="badge badge-primary cursor-pointer" onclick="toggleValue(this)">å‹¤åŠ³è€å¿ƒ</span>
                                    <span class="badge badge-primary cursor-pointer" onclick="toggleValue(this)">ç²¾ç›Šæ±‚ç²¾</span>
                                    <span class="badge badge-primary cursor-pointer" onclick="toggleValue(this)">åˆ›æ–°ç²¾ç¥</span>
                                    <span class="badge badge-primary cursor-pointer" onclick="toggleValue(this)">è´£ä»»æ‹…å½“</span>
                                    <span class="badge badge-primary cursor-pointer" onclick="toggleValue(this)">å›¢ç»“äº’åŠ©</span>
                                </div>
                                
                                <input type="text" 
                                       class="form-control" 
                                       id="customValue" 
                                       placeholder="æ·»åŠ è‡ªå®šä¹‰ä»·å€¼è§‚ï¼ˆæŒ‰å›è½¦æ·»åŠ ï¼‰"
                                       onkeypress="handleValueKeypress(event)">
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-8">
                                <button class="btn btn-outline" onclick="prevStep(2)">
                                    ä¸Šä¸€æ­¥ï¼šæŠ€èƒ½è¯¦è§£
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(4)">
                                    ä¸‹ä¸€æ­¥ï¼šå­¦ä¹ æŒæ¡
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤4ï¼šå­¦ä¹ æŒæ¡ -->
                <div class="wizard-step-content" id="step4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ¯ å­¦ä¹ æŒæ¡</h3>
                            <p class="card-subtitle">è®°å½•å­¦ä¹ è¿‡ç¨‹å’ŒæŒæ¡è®¡åˆ’</p>
                        </div>
                        <div class="card-body">
                            <!-- æŒæ¡ç¨‹åº¦ -->
                            <div class="form-group">
                                <label class="form-label">æ‚¨çš„æŒæ¡ç¨‹åº¦</label>
                                <div class="tooltip">
                                    <p class="text-sm text-gray-600 mb-3">æ‚¨ç›®å‰å¯¹è¿™é¡¹æŠ€èƒ½çš„æŒæ¡æƒ…å†µå¦‚ä½•ï¼Ÿ</p>
                                    <span class="tooltip-text">å®¢è§‚è¯„ä¼°è‡ªå·±çš„æŠ€èƒ½æ°´å¹³ï¼Œæœ‰åŠ©äºåˆ¶å®šå­¦ä¹ è®¡åˆ’</span>
                                </div>
                                
                                <div class="mastery-progress">
                                    <div class="mastery-bar">
                                        <div class="mastery-fill" id="masteryFill" style="width: 40%;"></div>
                                    </div>
                                    <div class="mastery-labels">
                                        <span>åˆå­¦è€…</span>
                                        <span>ç†Ÿç»ƒè€…</span>
                                        <span>ç²¾é€šè€…</span>
                                    </div>
                                </div>
                                
                                <input type="range" 
                                       min="0" 
                                       max="100" 
                                       value="40" 
                                       class="difficulty-slider" 
                                       id="masterySlider">
                                
                                <div class="mt-2 text-center">
                                    <span class="font-semibold text-primary-600" id="masteryText">åŸºæœ¬äº†è§£</span>
                                </div>
                            </div>
                            
                            <!-- å­¦ä¹ ç»å† -->
                            <div class="form-group">
                                <label class="form-label" for="learningExperience">å­¦ä¹ ç»å†</label>
                                <textarea class="form-control" 
                                          id="learningExperience" 
                                          rows="4"
                                          placeholder="æè¿°æ‚¨å­¦ä¹ è¿™é¡¹æŠ€èƒ½çš„ç»å†ã€å›°éš¾å’Œçªç ´..."></textarea>
                            </div>
                            
                            <!-- å­¦ä¹ èµ„æº -->
                            <div class="form-group">
                                <label class="form-label">å­¦ä¹ èµ„æºä¸æŒ‡å¯¼</label>
                                <p class="text-sm text-gray-600 mb-3">è®°å½•å¯ä»¥å¸®åŠ©å­¦ä¹ è¿™é¡¹æŠ€èƒ½çš„èµ„æºå’ŒæŒ‡å¯¼æ¥æº</p>
                                
                                <div id="resourcesContainer">
                                    <div class="tool-card">
                                        <div class="flex items-center gap-3">
                                            <select class="form-control form-control-sm" style="width: 120px;">
                                                <option>ä¹¦ç±èµ„æ–™</option>
                                                <option>è§†é¢‘æ•™ç¨‹</option>
                                                <option>é•¿è¾ˆæŒ‡å¯¼</option>
                                                <option>å®è·µæœºä¼š</option>
                                                <option>å…¶ä»–èµ„æº</option>
                                            </select>
                                            <input type="text" 
                                                   class="form-control form-control-sm" 
                                                   placeholder="èµ„æºæè¿°"
                                                   style="flex: 1;">
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline text-gray-600" onclick="removeResource(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline btn-sm" onclick="addResource()">
                                        <i class="fas fa-plus mr-2"></i> æ·»åŠ èµ„æº
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ä¼ æ‰¿è®¡åˆ’ -->
                            <div class="form-group">
                                <label class="form-label" for="heritagePlan">ä¼ æ‰¿è®¡åˆ’</label>
                                <div class="tooltip">
                                    <p class="text-sm text-gray-600 mb-3">æ‚¨è®¡åˆ’å¦‚ä½•å°†è¿™é¡¹æŠ€èƒ½ä¼ æ‰¿ä¸‹å»ï¼Ÿ</p>
                                    <span class="tooltip-text">è€ƒè™‘ä¼ æ‰¿å¯¹è±¡ã€æ—¶é—´å®‰æ’ã€æ•™å­¦æ–¹æ³•ç­‰å› ç´ </span>
                                </div>
                                
                                <textarea class="form-control" 
                                          id="heritagePlan" 
                                          rows="4"
                                          placeholder="æè¿°æ‚¨çš„æŠ€èƒ½ä¼ æ‰¿è®¡åˆ’ï¼ŒåŒ…æ‹¬ä¼ æ‰¿å¯¹è±¡ã€æ—¶é—´å®‰æ’å’Œå…·ä½“æ–¹æ³•..."></textarea>
                            </div>
                            
                            <!-- æŠ€èƒ½åº”ç”¨ -->
                            <div class="form-group">
                                <label class="form-label" for="skillApplication">æŠ€èƒ½åº”ç”¨ä¸åˆ›æ–°</label>
                                <textarea class="form-control" 
                                          id="skillApplication" 
                                          rows="4"
                                          placeholder="è¿™é¡¹æŠ€èƒ½åœ¨ç°ä»£ç”Ÿæ´»ä¸­çš„åº”ç”¨ä»·å€¼ï¼Œä»¥åŠæ‚¨å¯èƒ½çš„åˆ›æ–°æ–¹å‘..."></textarea>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-8">
                                <button class="btn btn-outline" onclick="prevStep(3)">
                                    ä¸Šä¸€æ­¥ï¼šä¼ æ‰¿è„‰ç»œ
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(5)">
                                    ä¸‹ä¸€æ­¥ï¼šå®Œæˆè®°å½•
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤5ï¼šå®Œæˆè®°å½• -->
                <div class="wizard-step-content" id="step5">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ‰ è®°å½•å®Œæˆï¼</h3>
                            <p class="card-subtitle">æŸ¥çœ‹æ‚¨çš„æŠ€èƒ½ä¼ æ‰¿è®°å½•æˆæœ</p>
                        </div>
                        <div class="card-body">
                            <!-- æŠ€èƒ½é¢„è§ˆ -->
                            <div class="skill-preview" id="skillPreview">
                                <div class="preview-header">
                                    <div class="preview-icon" id="previewIcon">ğŸ”§</div>
                                    <div class="preview-info">
                                        <h2 id="previewName">æœªå‘½åæŠ€èƒ½</h2>
                                        <div class="preview-category" id="previewCategory">æœªåˆ†ç±»</div>
                                        <div class="text-sm mt-1" id="previewSource">æ¥æºï¼šæœªçŸ¥</div>
                                    </div>
                                </div>
                                
                                <div class="preview-stats">
                                    <div class="preview-stat">
                                        <div class="preview-stat-value" id="previewDifficulty">3</div>
                                        <div class="preview-stat-label">éš¾åº¦ç­‰çº§</div>
                                    </div>
                                    <div class="preview-stat">
                                        <div class="preview-stat-value" id="previewImportance">3</div>
                                        <div class="preview-stat-label">é‡è¦æ€§</div>
                                    </div>
                                    <div class="preview-stat">
                                        <div class="preview-stat-value" id="previewSteps">0</div>
                                        <div class="preview-stat-label">è¯¦ç»†æ­¥éª¤</div>
                                    </div>
                                    <div class="preview-stat">
                                        <div class="preview-stat-value" id="previewMastery">40%</div>
                                        <div class="preview-stat-label">æŒæ¡ç¨‹åº¦</div>
                                    </div>
                                </div>
                                
                                <div class="preview-steps">
                                    <h4>æŠ€èƒ½ç‰¹ç‚¹</h4>
                                    <p id="previewDescription" class="opacity-90">æš‚æ— æè¿°</p>
                                </div>
                                
                                <div class="preview-steps mt-4">
                                    <h4>ä¼ æ‰¿è®¡åˆ’</h4>
                                    <p id="previewPlan" class="opacity-90">ç­‰å¾…æ‚¨æ¥åˆ¶å®š...</p>
                                </div>
                            </div>
                            
                            <!-- è®°å½•ç»Ÿè®¡ -->
                            <div class="insight-section mt-6">
                                <h4>ğŸ“Š è®°å½•ç»Ÿè®¡</h4>
                                <div class="grid grid-4 gap-4 mt-4">
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-primary-600" id="statSteps">0</div>
                                        <div class="text-sm text-gray-600">è®°å½•æ­¥éª¤</div>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-secondary-600" id="statTools">0</div>
                                        <div class="text-sm text-gray-600">å·¥å…·ææ–™</div>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-accent-600" id="statMemories">0</div>
                                        <div class="text-sm text-gray-600">ä¼ æ‰¿è®°å¿†</div>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-success-600" id="statCompletion">0%</div>
                                        <div class="text-sm text-gray-600">å®Œæˆåº¦</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ä¿å­˜å’Œåˆ†äº«é€‰é¡¹ -->
                            <div class="mt-8">
                                <div class="button-group" style="display: flex; gap: 12px; justify-content: center;">
                                    <button class="btn btn-primary" onclick="saveSkill()">
                                        <i class="fas fa-save"></i> ä¿å­˜è®°å½•
                                    </button>
                                    <button class="btn btn-secondary" onclick="exportSkill()">
                                        <i class="fas fa-download"></i> å¯¼å‡ºæŠ¥å‘Š
                                    </button>
                                    <button class="btn btn-accent" onclick="shareSkill()">
                                        <i class="fas fa-share-alt"></i> åˆ†äº«æŠ€èƒ½
                                    </button>
                                </div>
                                
                                <div class="mt-6 text-center">
                                    <p class="text-gray-600 mb-4">ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®ï¼š</p>
                                    <div class="flex flex-wrap gap-2 justify-center">
                                        <button class="btn btn-outline btn-sm" onclick="printGuide()">
                                            <i class="fas fa-print"></i> æ‰“å°å­¦ä¹ æŒ‡å—
                                        </button>
                                        <button class="btn btn-outline btn-sm" onclick="setReminder()">
                                            <i class="fas fa-bell"></i> è®¾ç½®ç»ƒä¹ æé†’
                                        </button>
                                        <button class="btn btn-outline btn-sm" onclick="startNewSkill()">
                                            <i class="fas fa-plus"></i> è®°å½•æ–°æŠ€èƒ½
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container footer-container">
            <div>
                <h4 class="footer-section-title">äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°</h4>
                <p class="text-gray-300 mt-2">é€šè¿‡æ•°å­—åŒ–ç»ƒä¹ ï¼Œæ¢ç´¢å®¶æ—è®°å¿†ï¼Œä¼ æ‰¿äººæ–‡ä»·å€¼</p>
            </div>
            <div>
                <h4 class="footer-section-title">ç»ƒä¹ å·¥å…·</h4>
                <ul class="footer-links">
                    <li><a href="photo-analyzer.html" class="footer-link">è€ç…§ç‰‡åˆ†æ</a></li>
                    <li><a href="character-explorer.html" class="footer-link">è§’è‰²æ¢ç´¢</a></li>
                    <li><a href="skill-heritage.html" class="footer-link">æŠ€èƒ½ä¼ æ‰¿</a></li>
                </ul>
            </div>
            <div>
                <h4 class="footer-section-title">æ”¯æŒä¸å¸®åŠ©</h4>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">ä½¿ç”¨æŒ‡å—</a></li>
                    <li><a href="#" class="footer-link">å¸¸è§é—®é¢˜</a></li>
                    <li><a href="#" class="footer-link">è”ç³»æˆ‘ä»¬</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2024 äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>

    <script>
        // æŠ€èƒ½ä¼ æ‰¿å™¨æ ¸å¿ƒé€»è¾‘
        class SkillHeritage {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 5;
                this.skillData = {
                    id: null,
                    icon: 'ğŸ”§',
                    name: '',
                    category: '',
                    source: '',
                    description: '',
                    difficulty: 3,
                    importance: 3,
                    steps: [],
                    tools: [],
                    tips: '',
                    heritageHistory: [],
                    memories: [],
                    values: [],
                    mastery: 40,
                    learningExperience: '',
                    resources: [],
                    heritagePlan: '',
                    application: '',
                    createdAt: null,
                    updatedAt: null,
                    completed: false
                };
                
                this.init();
            }
            
            init() {
                this.bindElements();
                this.initEventListeners();
                this.updateWizardProgress();
                this.loadSavedProgress();
                this.renderSkillNetwork();
            }
            
            bindElements() {
                this.elements = {
                    skillIconDisplay: document.getElementById('skillIconDisplay'),
                    skillName: document.getElementById('skillName'),
                    skillSource: document.getElementById('skillSource'),
                    skillDescription: document.getElementById('skillDescription'),
                    difficultySlider: document.getElementById('difficultySlider'),
                    difficultyText: document.getElementById('difficultyText'),
                    masterySlider: document.getElementById('masterySlider'),
                    masteryText: document.getElementById('masteryText'),
                    masteryFill: document.getElementById('masteryFill'),
                    skillPreview: document.getElementById('skillPreview'),
                    previewIcon: document.getElementById('previewIcon'),
                    previewName: document.getElementById('previewName'),
                    previewCategory: document.getElementById('previewCategory'),
                    previewSource: document.getElementById('previewSource'),
                    previewDescription: document.getElementById('previewDescription'),
                    previewDifficulty: document.getElementById('previewDifficulty'),
                    previewImportance: document.getElementById('previewImportance'),
                    previewSteps: document.getElementById('previewSteps'),
                    previewMastery: document.getElementById('previewMastery'),
                    previewPlan: document.getElementById('previewPlan'),
                    statSteps: document.getElementById('statSteps'),
                    statTools: document.getElementById('statTools'),
                    statMemories: document.getElementById('statMemories'),
                    statCompletion: document.getElementById('statCompletion')
                };
            }
            
            initEventListeners() {
                // å›¾æ ‡é€‰æ‹©
                this.elements.skillIconDisplay.addEventListener('click', () => this.showIconOptions());
                
                // ç±»åˆ«é€‰æ‹©
                document.querySelectorAll('.category-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const category = e.currentTarget.getAttribute('data-category');
                        this.selectCategory(category);
                    });
                });
                
                // éš¾åº¦æ»‘å—
                this.elements.difficultySlider.addEventListener('input', (e) => {
                    this.updateDifficulty(e.target.value);
                });
                
                // æŒæ¡åº¦æ»‘å—
                this.elements.masterySlider.addEventListener('input', (e) => {
                    this.updateMastery(e.target.value);
                });
                
                // é‡è¦æ€§è¯„åˆ†
                document.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('click', (e) => {
                        const value = parseInt(e.currentTarget.getAttribute('data-value'));
                        this.selectImportance(value);
                    });
                });
                
                // è¡¨å•è¾“å…¥ç›‘å¬
                this.elements.skillName.addEventListener('input', (e) => {
                    this.skillData.name = e.target.value;
                    this.updatePreview();
                });
                
                this.elements.skillSource.addEventListener('input', (e) => {
                    this.skillData.source = e.target.value;
                    this.updatePreview();
                });
                
                this.elements.skillDescription.addEventListener('input', (e) => {
                    this.skillData.description = e.target.value;
                    this.updatePreview();
                });
            }
            
            showIconOptions() {
                const options = document.getElementById('iconOptions');
                options.style.display = options.style.display === 'none' ? 'block' : 'none';
            }
            
            selectIcon(icon) {
                this.skillData.icon = icon;
                this.elements.skillIconDisplay.innerHTML = icon;
                this.elements.previewIcon.innerHTML = icon;
                this.showIconOptions();
            }
            
            selectCategory(category) {
                this.skillData.category = category;
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.category-card').forEach(card => {
                    card.classList.remove('selected');
                    if (card.getAttribute('data-category') === category) {
                        card.classList.add('selected');
                    }
                });
                
                this.updatePreview();
            }
            
            updateDifficulty(value) {
                this.skillData.difficulty = parseInt(value);
                const difficulties = ['éå¸¸ç®€å•', 'æ¯”è¾ƒç®€å•', 'ä¸­ç­‰éš¾åº¦', 'æ¯”è¾ƒå›°éš¾', 'éå¸¸å›°éš¾'];
                this.elements.difficultyText.textContent = difficulties[value - 1];
                this.elements.previewDifficulty.textContent = value;
            }
            
            selectImportance(value) {
                this.skillData.importance = value;
                
                // æ›´æ–°æ˜Ÿæ˜Ÿæ˜¾ç¤º
                document.querySelectorAll('.star').forEach((star, index) => {
                    if (index < value) {
                        star.classList.add('active');
                        star.textContent = 'â˜…';
                    } else {
                        star.classList.remove('active');
                        star.textContent = 'â˜†';
                    }
                });
                
                const importances = ['ä¸å¤ªé‡è¦', 'ä¸€èˆ¬é‡è¦', 'æ¯”è¾ƒé‡è¦', 'å¾ˆé‡è¦', 'éå¸¸é‡è¦'];
                document.getElementById('importanceText').textContent = importances[value - 1];
                this.elements.previewImportance.textContent = value;
            }
            
            updateMastery(value) {
                this.skillData.mastery = parseInt(value);
                this.elements.masteryFill.style.width = value + '%';
                
                let masteryText = '';
                if (value < 30) masteryText = 'åˆšå…¥é—¨';
                else if (value < 60) masteryText = 'åŸºæœ¬æŒæ¡';
                else if (value < 90) masteryText = 'æ¯”è¾ƒç†Ÿç»ƒ';
                else masteryText = 'ç²¾é€š';
                
                this.elements.masteryText.textContent = masteryText;
                this.elements.previewMastery.textContent = value + '%';
            }
            
            addStep() {
                const stepBuilder = document.getElementById('stepBuilder');
                const stepCount = stepBuilder.querySelectorAll('.step-item').length + 1;
                
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step-item';
                stepDiv.innerHTML = `
                    <div class="step-number">${stepCount}</div>
                    <div class="step-content">
                        <textarea class="form-control" 
                                  placeholder="ç¬¬${stepCount}æ­¥ï¼šæè¿°è¿™ä¸ªæ­¥éª¤çš„å…·ä½“åšæ³•..."
                                  rows="2"></textarea>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeStep(this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                stepBuilder.appendChild(stepDiv);
                this.updateStepNumbers();
            }
            
            removeStep(button) {
                const stepItem = button.closest('.step-item');
                if (stepItem && document.querySelectorAll('.step-item').length > 1) {
                    stepItem.remove();
                    this.updateStepNumbers();
                } else {
                    this.showAlert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ­¥éª¤', 'warning');
                }
            }
            
            updateStepNumbers() {
                document.querySelectorAll('.step-item').forEach((item, index) => {
                    item.querySelector('.step-number').textContent = index + 1;
                    const textarea = item.querySelector('textarea');
                    textarea.placeholder = `ç¬¬${index + 1}æ­¥ï¼šæè¿°è¿™ä¸ªæ­¥éª¤çš„å…·ä½“åšæ³•...`;
                });
            }
            
            addTool() {
                const toolsContainer = document.getElementById('toolsContainer');
                
                const toolDiv = document.createElement('div');
                toolDiv.className = 'tool-card';
                toolDiv.innerHTML = `
                    <div>
                        <input type="text" 
                               class="form-control form-control-sm" 
                               placeholder="å·¥å…·/ææ–™åç§°"
                               style="border: none; padding: 0; background: transparent;">
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeTool(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                toolsContainer.appendChild(toolDiv);
            }
            
            removeTool(button) {
                const toolCard = button.closest('.tool-card');
                if (toolCard && document.querySelectorAll('.tool-card').length > 1) {
                    toolCard.remove();
                } else if (toolCard) {
                    toolCard.querySelector('input').value = '';
                }
            }
            
            addHeritageItem() {
                const timeline = document.getElementById('heritageTimeline');
                const count = timeline.querySelectorAll('.heritage-item').length + 1;
                
                const generations = ['ç¬¬ä¸€ä»£ï¼šæ›¾ç¥–çˆ¶è¾ˆ', 'ç¬¬äºŒä»£ï¼šç¥–çˆ¶è¾ˆ', 'ç¬¬ä¸‰ä»£ï¼šçˆ¶è¾ˆ', 'ç¬¬å››ä»£ï¼šæˆ‘è¿™ä¸€ä»£', 'ç¬¬äº”ä»£ï¼šä¸‹ä¸€ä»£'];
                const generation = generations[Math.min(count - 1, generations.length - 1)];
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'heritage-item';
                itemDiv.innerHTML = `
                    <div class="heritage-generation">${generation}</div>
                    <div>è¯·æè¿°è¿™ä¸€ä»£çš„æŠ€èƒ½ä¼ æ‰¿æƒ…å†µ...</div>
                `;
                
                timeline.appendChild(itemDiv);
            }
            
            addMemory() {
                const container = document.getElementById('memoriesContainer');
                
                const memoryDiv = document.createElement('div');
                memoryDiv.className = 'memory-input';
                memoryDiv.innerHTML = `
                    <div class="memory-content">
                        <textarea class="form-control" 
                                  placeholder="æè¿°ä¸€ä¸ªä¸æŠ€èƒ½ä¼ æ‰¿ç›¸å…³çš„ç‰¹åˆ«è®°å¿†æˆ–æ•…äº‹..."
                                  rows="3"></textarea>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeMemory(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(memoryDiv);
            }
            
            removeMemory(button) {
                const memoryInput = button.closest('.memory-input');
                if (memoryInput) {
                    memoryInput.remove();
                }
            }
            
            toggleValue(element) {
                const value = element.textContent;
                if (element.classList.contains('badge-primary')) {
                    element.classList.remove('badge-primary');
                    element.classList.add('badge-secondary');
                } else {
                    element.classList.remove('badge-secondary');
                    element.classList.add('badge-primary');
                }
            }
            
            handleValueKeypress(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const customValue = document.getElementById('customValue').value.trim();
                    
                    if (customValue) {
                        // åˆ›å»ºæ–°çš„ä»·å€¼è§‚å¾½ç« 
                        const badge = document.createElement('span');
                        badge.className = 'badge badge-primary cursor-pointer';
                        badge.textContent = customValue;
                        badge.onclick = () => skillHeritage.toggleValue(badge);
                        
                        document.querySelector('.flex.flex-wrap.gap-2.mb-3').appendChild(badge);
                        document.getElementById('customValue').value = '';
                    }
                }
            }
            
            addResource() {
                const container = document.getElementById('resourcesContainer');
                
                const resourceDiv = document.createElement('div');
                resourceDiv.className = 'tool-card';
                resourceDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        <select class="form-control form-control-sm" style="width: 120px;">
                            <option>ä¹¦ç±èµ„æ–™</option>
                            <option>è§†é¢‘æ•™ç¨‹</option>
                            <option>é•¿è¾ˆæŒ‡å¯¼</option>
                            <option>å®è·µæœºä¼š</option>
                            <option>å…¶ä»–èµ„æº</option>
                        </select>
                        <input type="text" 
                               class="form-control form-control-sm" 
                               placeholder="èµ„æºæè¿°"
                               style="flex: 1;">
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeResource(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(resourceDiv);
            }
            
            removeResource(button) {
                const resourceCard = button.closest('.tool-card');
                if (resourceCard) {
                    resourceCard.remove();
                }
            }
            
            renderSkillNetwork() {
                const network = document.getElementById('skillNetwork');
                network.innerHTML = '';
                
                // åˆ›å»ºä¼ æ‰¿ç½‘ç»œèŠ‚ç‚¹
                const nodes = [
                    { x: '20%', y: '50%', icon: 'ğŸ‘´', label: 'ç¥–çˆ¶' },
                    { x: '40%', y: '30%', icon: 'ğŸ‘¨', label: 'çˆ¶äº²' },
                    { x: '40%', y: '70%', icon: 'ğŸ‘©', label: 'å§‘å§‘' },
                    { x: '60%', y: '50%', icon: 'ğŸ§‘', label: 'æˆ‘' },
                    { x: '80%', y: '50%', icon: 'ğŸ‘¦', label: 'ä¸‹ä¸€ä»£' }
                ];
                
                // åˆ›å»ºè¿æ¥çº¿
                const connections = [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 1, to: 3 },
                    { from: 2, to: 3 },
                    { from: 3, to: 4 }
                ];
                
                // ç»˜åˆ¶è¿æ¥çº¿
                connections.forEach(conn => {
                    const fromNode = nodes[conn.from];
                    const toNode = nodes[conn.to];
                    
                    const line = document.createElement('div');
                    line.className = 'network-line';
                    
                    // è®¡ç®—çº¿çš„ä½ç½®å’Œè§’åº¦
                    const fromX = parseFloat(fromNode.x) / 100 * network.offsetWidth;
                    const fromY = parseFloat(fromNode.y) / 100 * network.offsetHeight;
                    const toX = parseFloat(toNode.x) / 100 * network.offsetWidth;
                    const toY = parseFloat(toNode.y) / 100 * network.offsetHeight;
                    
                    const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                    const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
                    
                    line.style.width = length + 'px';
                    line.style.left = fromX + 'px';
                    line.style.top = fromY + 'px';
                    line.style.transform = `rotate(${angle}deg)`;
                    
                    network.appendChild(line);
                });
                
                // ç»˜åˆ¶èŠ‚ç‚¹
                nodes.forEach(node => {
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = 'network-node';
                    nodeDiv.style.left = node.x;
                    nodeDiv.style.top = node.y;
                    nodeDiv.innerHTML = node.icon;
                    nodeDiv.title = node.label;
                    
                    network.appendChild(nodeDiv);
                });
            }
            
            nextStep(step) {
                // éªŒè¯å½“å‰æ­¥éª¤
                if (!this.validateStep(this.currentStep)) {
                    this.showAlert('è¯·å…ˆå®Œæˆå½“å‰æ­¥éª¤çš„å¿…è¦ä¿¡æ¯', 'warning');
                    return;
                }
                
                // æ”¶é›†å½“å‰æ­¥éª¤æ•°æ®
                this.collectStepData(this.currentStep);
                
                // éšè—å½“å‰æ­¥éª¤
                document.getElementById(`step${this.currentStep}`).classList.remove('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.remove('active', 'completed');
                
                // æ˜¾ç¤ºä¸‹ä¸€æ­¥éª¤
                this.currentStep = step;
                document.getElementById(`step${this.currentStep}`).classList.add('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.add('active');
                
                // æ ‡è®°ä¸Šä¸€æ­¥ä¸ºå®Œæˆ
                document.querySelector(`.wizard-step[data-step="${this.currentStep - 1}"]`).classList.add('completed');
                
                this.updateWizardProgress();
                
                // å¦‚æœæ˜¯æœ€åä¸€æ­¥ï¼Œæ›´æ–°é¢„è§ˆ
                if (this.currentStep === 5) {
                    this.updatePreview();
                    this.updateStatistics();
                    this.elements.skillPreview.style.display = 'block';
                }
            }
            
            prevStep(step) {
                // æ”¶é›†å½“å‰æ­¥éª¤æ•°æ®
                this.collectStepData(this.currentStep);
                
                // éšè—å½“å‰æ­¥éª¤
                document.getElementById(`step${this.currentStep}`).classList.remove('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.remove('active');
                
                // æ˜¾ç¤ºä¸Šä¸€æ­¥éª¤
                this.currentStep = step;
                document.getElementById(`step${this.currentStep}`).classList.add('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.add('active');
                
                this.updateWizardProgress();
                
                // éšè—é¢„è§ˆ
                if (this.currentStep !== 5) {
                    this.elements.skillPreview.style.display = 'none';
                }
            }
            
            validateStep(step) {
                switch(step) {
                    case 1:
                        if (!this.skillData.name.trim()) {
                            this.showAlert('è¯·å¡«å†™æŠ€èƒ½åç§°', 'warning');
                            return false;
                        }
                        if (!this.skillData.category) {
                            this.showAlert('è¯·é€‰æ‹©æŠ€èƒ½ç±»åˆ«', 'warning');
                            return false;
                        }
                        break;
                    case 2:
                        // è‡³å°‘æœ‰ä¸€ä¸ªæ­¥éª¤
                        const stepCount = document.querySelectorAll('.step-item').length;
                        if (stepCount === 0) {
                            this.showAlert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæŠ€èƒ½æ­¥éª¤', 'warning');
                            return false;
                        }
                        break;
                    case 4:
                        const heritagePlan = document.getElementById('heritagePlan').value;
                        if (!heritagePlan.trim()) {
                            this.showAlert('è¯·å¡«å†™ä¼ æ‰¿è®¡åˆ’', 'warning');
                            return false;
                        }
                        break;
                }
                return true;
            }
            
            collectStepData(step) {
                switch(step) {
                    case 1:
                        this.skillData.name = this.elements.skillName.value;
                        this.skillData.source = this.elements.skillSource.value;
                        this.skillData.description = this.elements.skillDescription.value;
                        break;
                    case 2:
                        // æ”¶é›†æ­¥éª¤
                        this.skillData.steps = [];
                        document.querySelectorAll('.step-item').forEach(item => {
                            const text = item.querySelector('textarea').value;
                            if (text.trim()) {
                                this.skillData.steps.push(text);
                            }
                        });
                        
                        // æ”¶é›†å·¥å…·
                        this.skillData.tools = [];
                        document.querySelectorAll('.tool-card input').forEach(input => {
                            if (input.value.trim()) {
                                this.skillData.tools.push(input.value);
                            }
                        });
                        
                        this.skillData.tips = document.getElementById('skillTips').value;
                        break;
                    case 3:
                        // æ”¶é›†ä¼ æ‰¿å†å²
                        this.skillData.heritageHistory = [];
                        document.querySelectorAll('.heritage-item').forEach(item => {
                            const text = item.querySelector('div:last-child').textContent;
                            if (text && !text.includes('è¯·æè¿°')) {
                                this.skillData.heritageHistory.push(text);
                            }
                        });
                        
                        // æ”¶é›†è®°å¿†
                        this.skillData.memories = [];
                        document.querySelectorAll('.memory-input textarea').forEach(textarea => {
                            if (textarea.value.trim()) {
                                this.skillData.memories.push(textarea.value);
                            }
                        });
                        
                        // æ”¶é›†ä»·å€¼è§‚
                        this.skillData.values = [];
                        document.querySelectorAll('.badge-primary').forEach(badge => {
                            this.skillData.values.push(badge.textContent);
                        });
                        break;
                    case 4:
                        this.skillData.learningExperience = document.getElementById('learningExperience').value;
                        this.skillData.heritagePlan = document.getElementById('heritagePlan').value;
                        this.skillData.application = document.getElementById('skillApplication').value;
                        
                        // æ”¶é›†èµ„æº
                        this.skillData.resources = [];
                        document.querySelectorAll('#resourcesContainer .tool-card').forEach(card => {
                            const type = card.querySelector('select').value;
                            const desc = card.querySelector('input').value;
                            if (desc.trim()) {
                                this.skillData.resources.push({ type, description: desc });
                            }
                        });
                        break;
                }
            }
            
            updateWizardProgress() {
                // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                const steps = document.querySelectorAll('.wizard-step');
                steps.forEach((step, index) => {
                    const stepNum = parseInt(step.getAttribute('data-step'));
                    if (stepNum < this.currentStep) {
                        step.classList.add('completed');
                    } else if (stepNum === this.currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }
            
            updatePreview() {
                // æ›´æ–°åŸºæœ¬ä¿¡æ¯
                this.elements.previewName.textContent = this.skillData.name || 'æœªå‘½åæŠ€èƒ½';
                
                // æ›´æ–°ç±»åˆ«
                const categoryMap = {
                    'craft': 'æ‰‹å·¥è‰º',
                    'cooking': 'çƒ¹é¥ªæŠ€è‰º',
                    'sewing': 'ç¼çº«ç¼–ç»‡',
                    'art': 'è‰ºæœ¯åˆ›ä½œ',
                    'garden': 'å›­è‰ºç§æ¤',
                    'knowledge': 'ä¼ ç»ŸçŸ¥è¯†',
                    'music': 'éŸ³ä¹æŠ€è‰º',
                    'health': 'å¥åº·å…»ç”Ÿ'
                };
                this.elements.previewCategory.textContent = categoryMap[this.skillData.category] || 'æœªåˆ†ç±»';
                
                // æ›´æ–°æ¥æº
                this.elements.previewSource.textContent = `æ¥æºï¼š${this.skillData.source || 'æœªçŸ¥'}`;
                
                // æ›´æ–°æè¿°é¢„è§ˆï¼ˆæˆªå–å‰100å­—ï¼‰
                if (this.skillData.description) {
                    const previewText = this.skillData.description.length > 100 
                        ? this.skillData.description.substring(0, 100) + '...' 
                        : this.skillData.description;
                    this.elements.previewDescription.textContent = previewText;
                } else {
                    this.elements.previewDescription.textContent = 'æš‚æ— æè¿°';
                }
                
                // æ›´æ–°è®¡åˆ’é¢„è§ˆ
                if (this.skillData.heritagePlan) {
                    const planText = this.skillData.heritagePlan.length > 100
                        ? this.skillData.heritagePlan.substring(0, 100) + '...'
                        : this.skillData.heritagePlan;
                    this.elements.previewPlan.textContent = planText;
                } else {
                    this.elements.previewPlan.textContent = 'ç­‰å¾…æ‚¨æ¥åˆ¶å®š...';
                }
            }
            
            updateStatistics() {
                // æ­¥éª¤æ•°é‡
                this.elements.statSteps.textContent = this.skillData.steps.length;
                this.elements.previewSteps.textContent = this.skillData.steps.length;
                
                // å·¥å…·æ•°é‡
                this.elements.statTools.textContent = this.skillData.tools.length;
                
                // è®°å¿†æ•°é‡
                this.elements.statMemories.textContent = this.skillData.memories.length;
                
                // å®Œæˆåº¦è®¡ç®—
                let completionScore = 0;
                if (this.skillData.name) completionScore += 20;
                if (this.skillData.category) completionScore += 15;
                if (this.skillData.steps.length > 0) completionScore += 25;
                if (this.skillData.heritagePlan) completionScore += 20;
                if (this.skillData.values.length > 0) completionScore += 10;
                if (this.skillData.memories.length > 0) completionScore += 10;
                
                this.elements.statCompletion.textContent = completionScore + '%';
            }
            
            saveSkill() {
                // æ”¶é›†æ‰€æœ‰æ•°æ®
                this.collectStepData(this.currentStep);
                
                // éªŒè¯å¿…è¦æ•°æ®
                if (!this.validateStep(1) || !this.validateStep(2) || !this.validateStep(4)) {
                    this.showAlert('è¯·å…ˆå®Œæˆæ‰€æœ‰å¿…è¦æ­¥éª¤', 'warning');
                    return;
                }
                
                // è®¾ç½®IDå’Œæ—¶é—´æˆ³
                this.skillData.id = this.skillData.id || Date.now();
                this.skillData.createdAt = this.skillData.createdAt || new Date().toISOString();
                this.skillData.updatedAt = new Date().toISOString();
                this.skillData.completed = true;
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                try {
                    let skills = JSON.parse(localStorage.getItem('skillHeritages_v1') || '[]');
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆæ›´æ–°ï¼‰
                    const existingIndex = skills.findIndex(s => s.id === this.skillData.id);
                    if (existingIndex !== -1) {
                        skills[existingIndex] = this.skillData;
                    } else {
                        skills.push(this.skillData);
                    }
                    
                    localStorage.setItem('skillHeritages_v1', JSON.stringify(skills));
                    
                    this.showAlert('æŠ€èƒ½è®°å½•å·²ä¿å­˜ï¼', 'success');
                    
                    // è‡ªåŠ¨è·³è½¬åˆ°ä»ªè¡¨æ¿æˆ–ä¿æŒå½“å‰é¡µé¢
                    setTimeout(() => {
                        const shouldGoToDashboard = confirm('ä¿å­˜æˆåŠŸï¼æ˜¯å¦å‰å¾€ä»ªè¡¨æ¿æŸ¥çœ‹æ‰€æœ‰è®°å½•ï¼Ÿ');
                        if (shouldGoToDashboard) {
                            window.location.href = '../dashboard.html';
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('ä¿å­˜å¤±è´¥:', error);
                    this.showAlert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            }
            
            loadSavedProgress() {
                try {
                    const savedData = localStorage.getItem('currentSkillHeritage');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        Object.assign(this.skillData, data);
                        
                        // æ¢å¤è¡¨å•çŠ¶æ€
                        this.restoreFormState();
                        this.updatePreview();
                        
                        console.log('å·²æ¢å¤ä¿å­˜çš„è¿›åº¦');
                    }
                } catch (error) {
                    console.error('æ¢å¤è¿›åº¦å¤±è´¥:', error);
                }
            }
            
            restoreFormState() {
                // æ¢å¤å›¾æ ‡
                if (this.skillData.icon) {
                    this.selectIcon(this.skillData.icon);
                }
                
                // æ¢å¤åç§°
                if (this.skillData.name) {
                    this.elements.skillName.value = this.skillData.name;
                }
                
                // æ¢å¤ç±»åˆ«
                if (this.skillData.category) {
                    this.selectCategory(this.skillData.category);
                }
                
                // æ¢å¤éš¾åº¦
                if (this.skillData.difficulty) {
                    this.elements.difficultySlider.value = this.skillData.difficulty;
                    this.updateDifficulty(this.skillData.difficulty);
                }
                
                // æ¢å¤é‡è¦æ€§
                if (this.skillData.importance) {
                    this.selectImportance(this.skillData.importance);
                }
                
                // æ¢å¤æŒæ¡åº¦
                if (this.skillData.mastery) {
                    this.elements.masterySlider.value = this.skillData.mastery;
                    this.updateMastery(this.skillData.mastery);
                }
            }
            
            exportSkill() {
                this.collectStepData(this.currentStep);
                
                const exportData = {
                    title: 'å®¶æ—æŠ€èƒ½ä¼ æ‰¿æŠ¥å‘Š',
                    exportDate: new Date().toLocaleString('zh-CN'),
                    skillName: this.skillData.name,
                    category: this.skillData.category,
                    source: this.skillData.source,
                    
                    difficulty: this.skillData.difficulty,
                    importance: this.skillData.importance,
                    mastery: this.skillData.mastery,
                    
                    description: this.skillData.description,
                    steps: this.skillData.steps,
                    tools: this.skillData.tools,
                    tips: this.skillData.tips,
                    
                    heritageHistory: this.skillData.heritageHistory,
                    memories: this.skillData.memories,
                    values: this.skillData.values,
                    
                    learningExperience: this.skillData.learningExperience,
                    resources: this.skillData.resources,
                    heritagePlan: this.skillData.heritagePlan,
                    application: this.skillData.application,
                    
                    statistics: {
                        stepsCount: this.skillData.steps.length,
                        toolsCount: this.skillData.tools.length,
                        memoriesCount: this.skillData.memories.length,
                        valuesCount: this.skillData.values.length
                    }
                };
                
                // å¯¼å‡ºä¸ºJSON
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                    type: 'application/json' 
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æŠ€èƒ½ä¼ æ‰¿æŠ¥å‘Š_${this.skillData.name || 'æœªå‘½å'}_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showAlert('æŠ¥å‘Šå·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼', 'success');
            }
            
            shareSkill() {
                if (!this.skillData.name || !this.skillData.description) {
                    this.showAlert('è¯·å…ˆå®ŒæˆæŠ€èƒ½è®°å½•', 'warning');
                    return;
                }
                
                const shareText = `æˆ‘å‘ç°äº†ä¸€é¡¹ç‰¹åˆ«çš„å®¶æ—æŠ€èƒ½ï¼š${this.skillData.name}\n\n` +
                                 `æŠ€èƒ½ç±»åˆ«ï¼š${this.skillData.category}\n` +
                                 `ä¼ æ‰¿æ¥æºï¼š${this.skillData.source || 'å®¶æ—ä¼ ç»Ÿ'}\n\n` +
                                 `æŠ€èƒ½ç®€ä»‹ï¼š${this.skillData.description.substring(0, 80)}...\n\n` +
                                 `æ¢ç´¢æ›´å¤šå®¶æ—æŠ€èƒ½ï¼Œè¯·è®¿é—®äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°`;
                
                if (navigator.share) {
                    navigator.share({
                        title: `å®¶æ—æŠ€èƒ½ï¼š${this.skillData.name}`,
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    // å¤åˆ¶åˆ°å‰ªè´´æ¿
                    navigator.clipboard.writeText(shareText)
                        .then(() => this.showAlert('åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success'))
                        .catch(() => this.showAlert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error'));
                }
            }
            
            startNewSkill() {
                const confirmReset = confirm('å¼€å§‹æ–°çš„è®°å½•å°†æ¸…ç©ºå½“å‰å†…å®¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ');
                if (!confirmReset) return;
                
                // é‡ç½®æ•°æ®
                this.skillData = {
                    id: null,
                    icon: 'ğŸ”§',
                    name: '',
                    category: '',
                    source: '',
                    description: '',
                    difficulty: 3,
                    importance: 3,
                    steps: [],
                    tools: [],
                    tips: '',
                    heritageHistory: [],
                    memories: [],
                    values: [],
                    mastery: 40,
                    learningExperience: '',
                    resources: [],
                    heritagePlan: '',
                    application: '',
                    createdAt: null,
                    updatedAt: null,
                    completed: false
                };
                
                // é‡ç½®è¡¨å•
                this.resetForm();
                
                // è¿”å›ç¬¬ä¸€æ­¥
                this.currentStep = 1;
                document.querySelectorAll('.wizard-step-content').forEach(div => div.classList.remove('active'));
                document.getElementById('step1').classList.add('active');
                
                // é‡ç½®æ­¥éª¤æŒ‡ç¤ºå™¨
                document.querySelectorAll('.wizard-step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });
                document.querySelector('.wizard-step[data-step="1"]').classList.add('active');
                
                this.updateWizardProgress();
                
                // éšè—é¢„è§ˆ
                this.elements.skillPreview.style.display = 'none';
                
                this.showAlert('å·²å¼€å§‹æ–°çš„æŠ€èƒ½è®°å½•', 'info');
            }
            
            resetForm() {
                // é‡ç½®æ‰€æœ‰è¡¨å•å…ƒç´ 
                this.elements.skillIconDisplay.innerHTML = 'ğŸ”§';
                this.elements.skillName.value = '';
                this.elements.skillSource.value = '';
                this.elements.skillDescription.value = '';
                document.getElementById('skillTips').value = '';
                document.getElementById('learningExperience').value = '';
                document.getElementById('heritagePlan').value = '';
                document.getElementById('skillApplication').value = '';
                
                // é‡ç½®é€‰æ‹©çŠ¶æ€
                document.querySelectorAll('.category-card').forEach(card => card.classList.remove('selected'));
                document.querySelectorAll('.star').forEach((star, index) => {
                    star.classList.remove('active');
                    star.textContent = 'â˜†';
                });
                
                // é‡ç½®æ»‘å—
                this.elements.difficultySlider.value = 3;
                this.updateDifficulty(3);
                this.elements.masterySlider.value = 40;
                this.updateMastery(40);
                
                // æ¸…ç©ºåŠ¨æ€å†…å®¹
                document.getElementById('stepBuilder').innerHTML = `
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <textarea class="form-control" 
                                      placeholder="ç¬¬ä¸€æ­¥ï¼šæè¿°è¿™ä¸ªæ­¥éª¤çš„å…·ä½“åšæ³•..."
                                      rows="2"></textarea>
                        </div>
                        <div class="step-actions">
                            <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeStep(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('toolsContainer').innerHTML = `
                    <div class="tool-card">
                        <div>
                            <input type="text" 
                                   class="form-control form-control-sm" 
                                   placeholder="å·¥å…·/ææ–™åç§°"
                                   style="border: none; padding: 0; background: transparent;">
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeTool(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('heritageTimeline').innerHTML = `
                    <div class="heritage-item">
                        <div class="heritage-generation">ç¬¬ä¸€ä»£ï¼šæ›¾ç¥–çˆ¶è¾ˆ</div>
                        <div>æŠ€èƒ½èµ·æºï¼Œå¯èƒ½æ¥è‡ªå®¶æ—ä¼ ç»Ÿæˆ–ç‰¹å®šå¸ˆå‚…</div>
                    </div>
                    <div class="heritage-item">
                        <div class="heritage-generation">ç¬¬äºŒä»£ï¼šç¥–çˆ¶è¾ˆ</div>
                        <div>æŠ€èƒ½å‘å±•ä¸å®Œå–„ï¼Œå¯èƒ½å¢åŠ äº†ä¸ªäººç‰¹è‰²</div>
                    </div>
                `;
                
                document.getElementById('memoriesContainer').innerHTML = `
                    <div class="memory-input">
                        <div class="memory-content">
                            <textarea class="form-control" 
                                      placeholder="æè¿°ä¸€ä¸ªä¸æŠ€èƒ½ä¼ æ‰¿ç›¸å…³çš„ç‰¹åˆ«è®°å¿†æˆ–æ•…äº‹..."
                                      rows="3"></textarea>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeMemory(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('resourcesContainer').innerHTML = `
                    <div class="tool-card">
                        <div class="flex items-center gap-3">
                            <select class="form-control form-control-sm" style="width: 120px;">
                                <option>ä¹¦ç±èµ„æ–™</option>
                                <option>è§†é¢‘æ•™ç¨‹</option>
                                <option>é•¿è¾ˆæŒ‡å¯¼</option>
                                <option>å®è·µæœºä¼š</option>
                                <option>å…¶ä»–èµ„æº</option>
                            </select>
                            <input type="text" 
                                   class="form-control form-control-sm" 
                                   placeholder="èµ„æºæè¿°"
                                   style="flex: 1;">
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline text-gray-600" onclick="skillHeritage.removeResource(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // é‡ç½®é¢„è§ˆ
                this.updatePreview();
            }
            
            printGuide() {
                this.showAlert('æ‰“å°åŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å®ç°', 'info');
            }
            
            setReminder() {
                this.showAlert('æé†’åŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å®ç°', 'info');
            }
            
            showAlert(message, type = 'info') {
                // ç§»é™¤ç°æœ‰çš„æç¤º
                const existingAlert = document.querySelector('.alert-toast');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°æç¤º
                const alert = document.createElement('div');
                alert.className = `alert-toast alert-${type} fixed top-4 right-4 z-50 max-w-md`;
                alert.innerHTML = `
                    <div class="flex items-start p-4 rounded-lg shadow-lg animate-slide-in-right">
                        <div class="mr-3 text-lg">${this.getAlertIcon(type)}</div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                        <button class="ml-4 text-gray-400 hover:text-gray-600" onclick="this.parentElement.remove()">
                            &times;
                        </button>
                    </div>
                `;
                
                document.body.appendChild(alert);
                
                // è‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, 3000);
            }
            
            getAlertIcon(type) {
                const icons = {
                    success: 'âœ…',
                    error: 'âŒ',
                    warning: 'âš ï¸',
                    info: 'â„¹ï¸'
                };
                return icons[type] || 'â„¹ï¸';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.skillHeritage = new SkillHeritage();
            
            // ä¸ºå…¨å±€å‡½æ•°ç»‘å®šå®ä¾‹æ–¹æ³•
            window.nextStep = (step) => window.skillHeritage.nextStep(step);
            window.prevStep = (step) => window.skillHeritage.prevStep(step);
            window.saveSkill = () => window.skillHeritage.saveSkill();
            window.exportSkill = () => window.skillHeritage.exportSkill();
            window.shareSkill = () => window.skillHeritage.shareSkill();
            window.startNewSkill = () => window.skillHeritage.startNewSkill();
            window.showIconOptions = () => window.skillHeritage.showIconOptions();
            window.selectIcon = (icon) => window.skillHeritage.selectIcon(icon);
            window.addStep = () => window.skillHeritage.addStep();
            window.addTool = () => window.skillHeritage.addTool();
            window.addHeritageItem = () => window.skillHeritage.addHeritageItem();
            window.addMemory = () => window.skillHeritage.addMemory();
            window.addResource = () => window.skillHeritage.addResource();
            window.handleValueKeypress = (event) => window.skillHeritage.handleValueKeypress(event);
            window.printGuide = () => window.skillHeritage.printGuide();
            window.setReminder = () => window.skillHeritage.setReminder();
            
            // ä¿å­˜é¡µé¢ç¦»å¼€æ—¶çš„è¿›åº¦
            window.addEventListener('beforeunload', () => {
                window.skillHeritage.collectStepData(window.skillHeritage.currentStep);
                localStorage.setItem('currentSkillHeritage', JSON.stringify(window.skillHeritage.skillData));
            });
        });
    </script>
</body>
</html>
