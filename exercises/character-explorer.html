<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—è§’è‰²æ¢ç´¢ - äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* è§’è‰²æ¢ç´¢ç‰¹å®šæ ·å¼ */
        .character-wizard {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            margin: 0 auto 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid white;
            box-shadow: var(--shadow-lg);
        }
        
        .character-avatar:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-xl);
        }
        
        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
        }
        
        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            background: var(--neutral-100);
            transition: all 0.2s ease;
        }
        
        .avatar-option:hover {
            background: var(--neutral-200);
            transform: scale(1.1);
        }
        
        .avatar-option.active {
            background: var(--primary-100);
            border: 2px solid var(--primary-500);
        }
        
        .trait-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }
        
        .trait-badge {
            padding: 8px 16px;
            background: var(--neutral-100);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            border: 2px solid transparent;
        }
        
        .trait-badge:hover {
            background: var(--neutral-200);
        }
        
        .trait-badge.selected {
            background: var(--primary-100);
            color: var(--primary-700);
            border-color: var(--primary-300);
        }
        
        .relationship-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .relationship-card {
            padding: 16px;
            text-align: center;
            background: white;
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .relationship-card:hover {
            border-color: var(--primary-300);
            transform: translateY(-2px);
        }
        
        .relationship-card.selected {
            background: var(--primary-50);
            border-color: var(--primary-500);
        }
        
        .relationship-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .timeline-input {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 16px;
        }
        
        .timeline-input input {
            flex: 1;
        }
        
        .timeline-input span {
            white-space: nowrap;
            color: var(--neutral-600);
        }
        
        .story-input {
            min-height: 200px;
            resize: vertical;
        }
        
        .character-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-top: 32px;
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .preview-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .preview-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: var(--primary-600);
            flex-shrink: 0;
        }
        
        .preview-info h2 {
            color: white;
            margin-bottom: 4px;
        }
        
        .preview-relationship {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .preview-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
        }
        
        .preview-trait {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 14px;
        }
        
        .preview-story {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .preview-story h4 {
            color: white;
            margin-bottom: 12px;
        }
        
        .insight-section {
            margin-top: 32px;
            padding: 24px;
            background: var(--neutral-50);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--secondary-500);
        }
        
        .insight-point {
            margin: 16px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .insight-point:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
            top: 0;
        }
        
        .generation-visualization {
            width: 100%;
            height: 200px;
            background: linear-gradient(90deg, #f0f4ff, #e6f7ff);
            border-radius: var(--radius-lg);
            margin: 24px 0;
            position: relative;
            overflow: hidden;
        }
        
        .generation-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: var(--primary-300);
            top: 50%;
            transform: translateY(-50%);
        }
        
        .generation-node {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-md);
            border: 3px solid var(--primary-500);
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* æƒ…æ„Ÿé€‰æ‹©å™¨ */
        .emotion-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
        }
        
        .emotion-card {
            flex: 1;
            min-width: 120px;
            padding: 16px;
            text-align: center;
            background: white;
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .emotion-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        
        .emotion-card.selected {
            border-color: var(--accent-500);
            background: var(--accent-50);
        }
        
        .emotion-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        /* æ—¶é—´çº¿æ ·å¼ */
        .memory-timeline {
            margin: 24px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .memory-timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--primary-400), var(--secondary-400));
        }
        
        .memory-item {
            position: relative;
            margin-bottom: 24px;
            padding: 16px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary-400);
        }
        
        .memory-item:before {
            content: '';
            position: absolute;
            left: -30px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-500);
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--primary-200);
        }
        
        .memory-year {
            font-weight: bold;
            color: var(--primary-600);
            margin-bottom: 4px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .character-wizard {
                padding: 16px;
            }
            
            .relationship-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .emotion-card {
                min-width: 100px;
            }
            
            .preview-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="../index.html" class="navbar-brand">
                <div class="navbar-logo">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                <span>äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°</span>
            </a>
            <ul class="navbar-menu">
                <li class="navbar-item">
                    <a href="../index.html" class="navbar-link">é¦–é¡µ</a>
                </li>
                <li class="navbar-item">
                    <a href="../exercises/photo-analyzer.html" class="navbar-link">ç…§ç‰‡åˆ†æ</a>
                </li>
                <li class="navbar-item">
                    <a href="../exercises/character-explorer.html" class="navbar-link active">è§’è‰²æ¢ç´¢</a>
                </li>
                <li class="navbar-item">
                    <a href="../exercises/skill-heritage.html" class="navbar-link">æŠ€èƒ½ä¼ æ‰¿</a>
                </li>
                <li class="navbar-item">
                    <a href="../dashboard.html" class="navbar-link">ä»ªè¡¨æ¿</a>
                </li>
            </ul>
            <div class="navbar-actions">
                <button class="btn btn-primary btn-sm" onclick="saveExploration()">
                    <i class="fas fa-save"></i> ä¿å­˜
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- å‘å¯¼å¼å¯¼èˆª -->
        <div class="wizard">
            <div class="wizard-steps">
                <div class="wizard-step active" data-step="1">
                    <div class="wizard-step-number">1</div>
                    <div class="wizard-step-label">åŸºæœ¬ä¿¡æ¯</div>
                </div>
                <div class="wizard-step" data-step="2">
                    <div class="wizard-step-number">2</div>
                    <div class="wizard-step-label">æ€§æ ¼ç‰¹ç‚¹</div>
                </div>
                <div class="wizard-step" data-step="3">
                    <div class="wizard-step-number">3</div>
                    <div class="wizard-step-label">äººç”Ÿæ•…äº‹</div>
                </div>
                <div class="wizard-step" data-step="4">
                    <div class="wizard-step-number">4</div>
                    <div class="wizard-step-label">å½±å“å¯ç¤º</div>
                </div>
                <div class="wizard-step" data-step="5">
                    <div class="wizard-step-number">5</div>
                    <div class="wizard-step-label">å®Œæˆæ¢ç´¢</div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="character-wizard">
            <div class="wizard-content">
                <!-- æ­¥éª¤1ï¼šåŸºæœ¬ä¿¡æ¯ -->
                <div class="wizard-step-content active" id="step1">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h3>
                            <p class="card-subtitle">è®©æˆ‘ä»¬ä»æœ€åŸºæœ¬çš„ä¿¡æ¯å¼€å§‹äº†è§£è¿™ä½å®¶äºº</p>
                        </div>
                        <div class="card-body">
                            <!-- å¤´åƒé€‰æ‹© -->
                            <div class="text-center mb-6">
                                <div class="character-avatar" id="avatarDisplay" onclick="showAvatarOptions()">
                                    ğŸ‘¤
                                </div>
                                <p class="text-sm text-gray-600">ç‚¹å‡»å¤´åƒé€‰æ‹©è¡¨æƒ…</p>
                                
                                <div class="avatar-options" id="avatarOptions" style="display: none;">
                                    <div class="avatar-option" data-avatar="ğŸ‘´">ğŸ‘´</div>
                                    <div class="avatar-option" data-avatar="ğŸ‘µ">ğŸ‘µ</div>
                                    <div class="avatar-option" data-avatar="ğŸ‘¨">ğŸ‘¨</div>
                                    <div class="avatar-option" data-avatar="ğŸ‘©">ğŸ‘©</div>
                                    <div class="avatar-option" data-avatar="ğŸ‘¦">ğŸ‘¦</div>
                                    <div class="avatar-option" data-avatar="ğŸ‘§">ğŸ‘§</div>
                                    <div class="avatar-option" data-avatar="ğŸ§“">ğŸ§“</div>
                                    <div class="avatar-option" data-avatar="ğŸ§‘">ğŸ§‘</div>
                                </div>
                            </div>
                            
                            <!-- å§“åè¾“å…¥ -->
                            <div class="form-group">
                                <label class="form-label" for="characterName">è§’è‰²å§“å</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="characterName" 
                                       placeholder="è¯·è¾“å…¥å§“åï¼ˆå¦‚ï¼šç‹å»ºå›½ï¼‰"
                                       value="">
                            </div>
                            
                            <!-- å…³ç³»é€‰æ‹© -->
                            <div class="form-group">
                                <label class="form-label">ä¸æ‚¨çš„å…³ç³»</label>
                                <div class="relationship-selector">
                                    <div class="relationship-card" data-relationship="ç¥–çˆ¶">
                                        <div class="relationship-icon">ğŸ‘´</div>
                                        <div>ç¥–çˆ¶</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="ç¥–æ¯">
                                        <div class="relationship-icon">ğŸ‘µ</div>
                                        <div>ç¥–æ¯</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="çˆ¶äº²">
                                        <div class="relationship-icon">ğŸ‘¨</div>
                                        <div>çˆ¶äº²</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="æ¯äº²">
                                        <div class="relationship-icon">ğŸ‘©</div>
                                        <div>æ¯äº²</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="å”å”">
                                        <div class="relationship-icon">ğŸ§”</div>
                                        <div>å”å”</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="é˜¿å§¨">
                                        <div class="relationship-icon">ğŸ‘±â€â™€ï¸</div>
                                        <div>é˜¿å§¨</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="å…„å¼Ÿ">
                                        <div class="relationship-icon">ğŸ‘¬</div>
                                        <div>å…„å¼Ÿ</div>
                                    </div>
                                    <div class="relationship-card" data-relationship="å§å¦¹">
                                        <div class="relationship-icon">ğŸ‘­</div>
                                        <div>å§å¦¹</div>
                                    </div>
                                </div>
                                <input type="text" 
                                       class="form-control mt-3" 
                                       id="relationshipOther" 
                                       placeholder="å…¶ä»–å…³ç³»ï¼ˆå¦‚ï¼šè¡¨èˆ…ã€é‚»å±…ç­‰ï¼‰"
                                       style="display: none;">
                            </div>
                            
                            <!-- å¹´ä»£ä¿¡æ¯ -->
                            <div class="form-group">
                                <label class="form-label">å¹´ä»£ä¿¡æ¯</label>
                                <div class="timeline-input">
                                    <input type="number" 
                                           class="form-control" 
                                           id="birthYear" 
                                           placeholder="å‡ºç”Ÿå¹´ä»½" 
                                           min="1900" 
                                           max="2024">
                                    <span>å¹´</span>
                                    <input type="number" 
                                           class="form-control" 
                                           id="birthMonth" 
                                           placeholder="æœˆä»½" 
                                           min="1" 
                                           max="12">
                                    <span>æœˆ</span>
                                </div>
                            </div>
                            
                            <!-- ä¸–ä»£å¯è§†åŒ– -->
                            <div class="generation-visualization" id="generationVisualization">
                                <div class="generation-line"></div>
                                <div class="generation-node" style="left: 20%;">
                                    <div>æ›¾ç¥–</div>
                                </div>
                                <div class="generation-node" style="left: 40%;">
                                    <div>ç¥–è¾ˆ</div>
                                </div>
                                <div class="generation-node" style="left: 60%;">
                                    <div id="currentGenerationNode">å½“å‰</div>
                                </div>
                                <div class="generation-node" style="left: 80%;">
                                    <div>æ™šè¾ˆ</div>
                                </div>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-6">
                                <button class="btn btn-outline" disabled>
                                    ä¸Šä¸€æ­¥
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(2)">
                                    ä¸‹ä¸€æ­¥ï¼šæ€§æ ¼ç‰¹ç‚¹
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤2ï¼šæ€§æ ¼ç‰¹ç‚¹ -->
                <div class="wizard-step-content" id="step2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ§  æ€§æ ¼ç‰¹ç‚¹</h3>
                            <p class="card-subtitle">æè¿°è¿™ä½å®¶äººçš„æ€§æ ¼ç‰¹ç‚¹å’Œå“è´¨</p>
                        </div>
                        <div class="card-body">
                            <!-- æ€§æ ¼ç‰¹è´¨é€‰æ‹© -->
                            <div class="form-group">
                                <label class="form-label">ä¸»è¦æ€§æ ¼ç‰¹è´¨</label>
                                <p class="text-sm text-gray-600 mb-3">è¯·é€‰æ‹©æœ€èƒ½æè¿°è¿™ä½å®¶äººçš„æ€§æ ¼ç‰¹è´¨ï¼ˆå¯å¤šé€‰ï¼‰</p>
                                
                                <div class="trait-selector" id="traitSelector">
                                    <div class="trait-badge" data-trait="å–„è‰¯">å–„è‰¯</div>
                                    <div class="trait-badge" data-trait="å‹¤åŠ³">å‹¤åŠ³</div>
                                    <div class="trait-badge" data-trait="æ™ºæ…§">æ™ºæ…§</div>
                                    <div class="trait-badge" data-trait="å‹‡æ•¢">å‹‡æ•¢</div>
                                    <div class="trait-badge" data-trait="å¹½é»˜">å¹½é»˜</div>
                                    <div class="trait-badge" data-trait="åšéŸ§">åšéŸ§</div>
                                    <div class="trait-badge" data-trait="ä¹è§‚">ä¹è§‚</div>
                                    <div class="trait-badge" data-trait="è¯šå®">è¯šå®</div>
                                    <div class="trait-badge" data-trait="ç»†å¿ƒ">ç»†å¿ƒ</div>
                                    <div class="trait-badge" data-trait="å¤§æ–¹">å¤§æ–¹</div>
                                    <div class="trait-badge" data-trait="ä¸¥æ ¼">ä¸¥æ ¼</div>
                                    <div class="trait-badge" data-trait="æ¸©æŸ”">æ¸©æŸ”</div>
                                </div>
                                
                                <div class="mt-3">
                                    <input type="text" 
                                           class="form-control" 
                                           id="customTrait" 
                                           placeholder="æ·»åŠ è‡ªå®šä¹‰ç‰¹è´¨ï¼ˆæŒ‰å›è½¦æ·»åŠ ï¼‰"
                                           onkeypress="handleTraitKeypress(event)">
                                </div>
                            </div>
                            
                            <!-- æƒ…æ„Ÿè¿æ¥ -->
                            <div class="form-group">
                                <label class="form-label">æƒ…æ„Ÿè¿æ¥</label>
                                <p class="text-sm text-gray-600 mb-3">æ‚¨å¯¹è¿™ä½å®¶äººçš„ä¸»è¦æƒ…æ„Ÿæ˜¯ä»€ä¹ˆï¼Ÿ</p>
                                
                                <div class="emotion-selector">
                                    <div class="emotion-card" data-emotion="æ•¬çˆ±">
                                        <div class="emotion-icon">ğŸ™</div>
                                        <div>æ•¬çˆ±</div>
                                    </div>
                                    <div class="emotion-card" data-emotion="äº²è¿‘">
                                        <div class="emotion-icon">â¤ï¸</div>
                                        <div>äº²è¿‘</div>
                                    </div>
                                    <div class="emotion-card" data-emotion="æ„Ÿæ¿€">
                                        <div class="emotion-icon">ğŸ¥°</div>
                                        <div>æ„Ÿæ¿€</div>
                                    </div>
                                    <div class="emotion-card" data-emotion="æ€€å¿µ">
                                        <div class="emotion-icon">ğŸ˜”</div>
                                        <div>æ€€å¿µ</div>
                                    </div>
                                    <div class="emotion-card" data-emotion="å°Šæ•¬">
                                        <div class="emotion-icon">ğŸ‘‘</div>
                                        <div>å°Šæ•¬</div>
                                    </div>
                                    <div class="emotion-card" data-emotion="é’¦ä½©">
                                        <div class="emotion-icon">ğŸŒŸ</div>
                                        <div>é’¦ä½©</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å£å¤´ç¦…æˆ–ä¹ æƒ¯ -->
                            <div class="form-group">
                                <label class="form-label" for="habit">å£å¤´ç¦…æˆ–ç‰¹åˆ«ä¹ æƒ¯</label>
                                <textarea class="form-control" 
                                          id="habit" 
                                          rows="3"
                                          placeholder="è¿™ä½å®¶äººå¸¸è¯´çš„è¯ã€ç‰¹åˆ«çš„ä¹ æƒ¯æˆ–åŠ¨ä½œ..."></textarea>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-6">
                                <button class="btn btn-outline" onclick="prevStep(1)">
                                    ä¸Šä¸€æ­¥ï¼šåŸºæœ¬ä¿¡æ¯
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(3)">
                                    ä¸‹ä¸€æ­¥ï¼šäººç”Ÿæ•…äº‹
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤3ï¼šäººç”Ÿæ•…äº‹ -->
                <div class="wizard-step-content" id="step3">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“– äººç”Ÿæ•…äº‹</h3>
                            <p class="card-subtitle">è®°å½•è¿™ä½å®¶äººçš„é‡è¦ç»å†å’Œæ•…äº‹</p>
                        </div>
                        <div class="card-body">
                            <!-- äººç”Ÿé˜¶æ®µå¼•å¯¼ -->
                            <div class="insight-section">
                                <h4>ğŸ’¡ æ€è€ƒæç¤º</h4>
                                <div class="insight-point">ç«¥å¹´æ—¶æœŸçš„é‡è¦ç»å†æˆ–æˆé•¿ç¯å¢ƒ</div>
                                <div class="insight-point">é’å¹´æ—¶æœŸçš„æ±‚å­¦ã€å·¥ä½œæˆ–å©šå§»ç»å†</div>
                                <div class="insight-point">ä¸­å¹´æ—¶æœŸçš„å®¶åº­è´£ä»»æˆ–äº‹ä¸šæˆå°±</div>
                                <div class="insight-point">è€å¹´æ—¶æœŸçš„æ™ºæ…§ä¼ æ‰¿æˆ–äººç”Ÿæ„Ÿæ‚Ÿ</div>
                            </div>
                            
                            <!-- äººç”Ÿæ•…äº‹è¾“å…¥ -->
                            <div class="form-group">
                                <label class="form-label" for="lifeStory">äººç”Ÿæ•…äº‹</label>
                                <textarea class="form-control story-input" 
                                          id="lifeStory" 
                                          placeholder="è¯·è¯¦ç»†æè¿°è¿™ä½å®¶äººçš„ç”Ÿå¹³æ•…äº‹ã€é‡è¦ç»å†å’Œæˆå°±..."></textarea>
                            </div>
                            
                            <!-- é‡è¦è®°å¿†æ—¶é—´çº¿ -->
                            <div class="form-group">
                                <label class="form-label">é‡è¦è®°å¿†æ—¶é—´çº¿</label>
                                <div class="memory-timeline" id="memoryTimeline">
                                    <div class="memory-item">
                                        <div class="memory-year">1949å¹´</div>
                                        <div>ä¸­åäººæ°‘å…±å’Œå›½æˆç«‹ï¼Œå¾ˆå¤šé•¿è¾ˆéƒ½ç»å†äº†è¿™ä¸€å†å²æ—¶åˆ»</div>
                                    </div>
                                    <div class="memory-item">
                                        <div class="memory-year">1978å¹´</div>
                                        <div>æ”¹é©å¼€æ”¾å¼€å§‹ï¼Œç»æµå’Œç¤¾ä¼šå‘ç”Ÿäº†å·¨å¤§å˜åŒ–</div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline btn-sm" onclick="addMemory()">
                                        <i class="fas fa-plus"></i> æ·»åŠ é‡è¦è®°å¿†
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ç…§ç‰‡ä¸Šä¼ ï¼ˆå¯é€‰ï¼‰ -->
                            <div class="form-group">
                                <label class="form-label">ç›¸å…³ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                                <div class="photo-upload-area" onclick="document.getElementById('storyPhoto').click()">
                                    <div class="upload-icon">ğŸ“·</div>
                                    <h3>ä¸Šä¼ ç…§ç‰‡</h3>
                                    <p>æ·»åŠ ä¸è¿™ä½å®¶äººç›¸å…³çš„ç…§ç‰‡ï¼ˆæ”¯æŒ JPGã€PNG æ ¼å¼ï¼‰</p>
                                    <input type="file" id="storyPhoto" accept="image/*" style="display: none;">
                                </div>
                                <div id="photoPreview" class="mt-3" style="display: none;"></div>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-6">
                                <button class="btn btn-outline" onclick="prevStep(2)">
                                    ä¸Šä¸€æ­¥ï¼šæ€§æ ¼ç‰¹ç‚¹
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(4)">
                                    ä¸‹ä¸€æ­¥ï¼šå½±å“å¯ç¤º
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤4ï¼šå½±å“å¯ç¤º -->
                <div class="wizard-step-content" id="step4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">âœ¨ å½±å“å¯ç¤º</h3>
                            <p class="card-subtitle">æ€è€ƒè¿™ä½å®¶äººå¯¹æ‚¨å’Œå®¶æ—çš„å½±å“</p>
                        </div>
                        <div class="card-body">
                            <!-- å¯¹æˆ‘çš„å½±å“ -->
                            <div class="form-group">
                                <label class="form-label" for="personalImpact">å¯¹æ‚¨çš„ä¸ªäººå½±å“</label>
                                <textarea class="form-control" 
                                          id="personalImpact" 
                                          rows="4"
                                          placeholder="è¿™ä½å®¶äººå¯¹æ‚¨çš„æ€§æ ¼ã€ä»·å€¼è§‚ã€äººç”Ÿé€‰æ‹©ç­‰æ–¹é¢æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ"></textarea>
                            </div>
                            
                            <!-- å¯¹å®¶æ—çš„å½±å“ -->
                            <div class="form-group">
                                <label class="form-label" for="familyImpact">å¯¹å®¶æ—çš„å½±å“</label>
                                <textarea class="form-control" 
                                          id="familyImpact" 
                                          rows="4"
                                          placeholder="è¿™ä½å®¶äººåœ¨å®¶æ—ä¸­çš„è§’è‰²ã€å¯¹å®¶æ—çš„è´¡çŒ®æˆ–æ”¹å˜..."></textarea>
                            </div>
                            
                            <!-- ä¼ æ‰¿çš„ä»·å€¼è§‚ -->
                            <div class="form-group">
                                <label class="form-label">ä¼ æ‰¿çš„ä»·å€¼è§‚</label>
                                <div class="trait-selector">
                                    <div class="trait-badge" data-value="å‹¤åŠ³è‡´å¯Œ">å‹¤åŠ³è‡´å¯Œ</div>
                                    <div class="trait-badge" data-value="è¯šå®å®ˆä¿¡">è¯šå®å®ˆä¿¡</div>
                                    <div class="trait-badge" data-value="å°Šè€çˆ±å¹¼">å°Šè€çˆ±å¹¼</div>
                                    <div class="trait-badge" data-value="é‡è§†æ•™è‚²">é‡è§†æ•™è‚²</div>
                                    <div class="trait-badge" data-value="å®¶åº­å’Œç¦">å®¶åº­å’Œç¦</div>
                                    <div class="trait-badge" data-value="ä¹äºåŠ©äºº">ä¹äºåŠ©äºº</div>
                                    <div class="trait-badge" data-value="åšéŸ§ä¸æ‹”">åšéŸ§ä¸æ‹”</div>
                                    <div class="trait-badge" data-value="çŸ¥è¶³å¸¸ä¹">çŸ¥è¶³å¸¸ä¹</div>
                                </div>
                                <textarea class="form-control mt-3" 
                                          id="customValues" 
                                          rows="2"
                                          placeholder="å…¶ä»–é‡è¦çš„ä»·å€¼è§‚..."></textarea>
                            </div>
                            
                            <!-- å¸Œæœ›ä¼ æ‰¿ç»™åä»£ -->
                            <div class="form-group">
                                <label class="form-label" for="legacy">å¸Œæœ›ä¼ æ‰¿ç»™åä»£</label>
                                <textarea class="form-control" 
                                          id="legacy" 
                                          rows="4"
                                          placeholder="æ‚¨å¸Œæœ›æŠŠè¿™ä½å®¶äººçš„å“ªäº›ç²¾ç¥ã€æ•…äº‹æˆ–å“è´¨ä¼ æ‰¿ç»™ä¸‹ä¸€ä»£ï¼Ÿ"></textarea>
                            </div>
                            
                            <!-- å¯¼èˆªæŒ‰é’® -->
                            <div class="flex justify-between mt-6">
                                <button class="btn btn-outline" onclick="prevStep(3)">
                                    ä¸Šä¸€æ­¥ï¼šäººç”Ÿæ•…äº‹
                                </button>
                                <button class="btn btn-primary" onclick="nextStep(5)">
                                    ä¸‹ä¸€æ­¥ï¼šå®Œæˆæ¢ç´¢
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥éª¤5ï¼šå®Œæˆæ¢ç´¢ -->
                <div class="wizard-step-content" id="step5">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ‰ æ¢ç´¢å®Œæˆï¼</h3>
                            <p class="card-subtitle">æŸ¥çœ‹æ‚¨çš„è§’è‰²æ¢ç´¢æˆæœ</p>
                        </div>
                        <div class="card-body">
                            <!-- è§’è‰²é¢„è§ˆ -->
                            <div class="character-preview" id="characterPreview">
                                <div class="preview-header">
                                    <div class="preview-avatar" id="previewAvatar">ğŸ‘¤</div>
                                    <div class="preview-info">
                                        <h2 id="previewName">æœªå‘½å</h2>
                                        <div class="preview-relationship" id="previewRelationship">æœªçŸ¥å…³ç³»</div>
                                        <div class="text-sm mt-1" id="previewAge">å¹´ä»£ä¸è¯¦</div>
                                    </div>
                                </div>
                                
                                <div class="preview-traits" id="previewTraits">
                                    <!-- ç‰¹è´¨ä¼šé€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                                </div>
                                
                                <div class="preview-story">
                                    <h4>äººç”Ÿæ•…äº‹</h4>
                                    <p id="previewStory" class="opacity-90">æš‚æ— æ•…äº‹æè¿°</p>
                                </div>
                                
                                <div class="preview-story mt-4">
                                    <h4>ä¼ æ‰¿çš„ä»·å€¼è§‚</h4>
                                    <p id="previewLegacy" class="opacity-90">ç­‰å¾…æ‚¨æ¥è®°å½•...</p>
                                </div>
                            </div>
                            
                            <!-- æ¢ç´¢æ€»ç»“ -->
                            <div class="insight-section mt-6">
                                <h4>ğŸ“Š æ¢ç´¢æ€»ç»“</h4>
                                <div class="grid grid-2 gap-4 mt-4">
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-primary-600" id="traitCount">0</div>
                                        <div class="text-sm text-gray-600">è¯†åˆ«ç‰¹è´¨</div>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-secondary-600" id="storyLength">0</div>
                                        <div class="text-sm text-gray-600">æ•…äº‹å­—æ•°</div>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-accent-600" id="valueCount">0</div>
                                        <div class="text-sm text-gray-600">ä¼ æ‰¿ä»·å€¼</div>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <div class="text-2xl font-bold text-success-600" id="completionRate">0%</div>
                                        <div class="text-sm text-gray-600">å®Œæˆåº¦</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ä¿å­˜å’Œåˆ†äº«é€‰é¡¹ -->
                            <div class="mt-8">
                                <div class="button-group" style="display: flex; gap: 12px; justify-content: center;">
                                    <button class="btn btn-primary" onclick="saveExploration()">
                                        <i class="fas fa-save"></i> ä¿å­˜æ¢ç´¢
                                    </button>
                                    <button class="btn btn-secondary" onclick="exportExploration()">
                                        <i class="fas fa-download"></i> å¯¼å‡ºæŠ¥å‘Š
                                    </button>
                                    <button class="btn btn-accent" onclick="shareExploration()">
                                        <i class="fas fa-share-alt"></i> åˆ†äº«æ•…äº‹
                                    </button>
                                </div>
                                
                                <div class="mt-4 text-center">
                                    <button class="btn btn-outline" onclick="startNewExploration()">
                                        <i class="fas fa-plus"></i> å¼€å§‹æ–°æ¢ç´¢
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container footer-container">
            <div>
                <h4 class="footer-section-title">äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°</h4>
                <p class="text-gray-300 mt-2">é€šè¿‡æ•°å­—åŒ–ç»ƒä¹ ï¼Œæ¢ç´¢å®¶æ—è®°å¿†ï¼Œä¼ æ‰¿äººæ–‡ä»·å€¼</p>
            </div>
            <div>
                <h4 class="footer-section-title">ç»ƒä¹ å·¥å…·</h4>
                <ul class="footer-links">
                    <li><a href="photo-analyzer.html" class="footer-link">è€ç…§ç‰‡åˆ†æ</a></li>
                    <li><a href="character-explorer.html" class="footer-link">è§’è‰²æ¢ç´¢</a></li>
                    <li><a href="skill-heritage.html" class="footer-link">æŠ€èƒ½ä¼ æ‰¿</a></li>
                </ul>
            </div>
            <div>
                <h4 class="footer-section-title">æ”¯æŒä¸å¸®åŠ©</h4>
                <ul class="footer-links">
                    <li><a href="#" class="footer-link">ä½¿ç”¨æŒ‡å—</a></li>
                    <li><a href="#" class="footer-link">å¸¸è§é—®é¢˜</a></li>
                    <li><a href="#" class="footer-link">è”ç³»æˆ‘ä»¬</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2024 äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>

    <script>
        // è§’è‰²æ¢ç´¢å™¨æ ¸å¿ƒé€»è¾‘
        class CharacterExplorer {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 5;
                this.explorationData = {
                    id: null,
                    avatar: 'ğŸ‘¤',
                    name: '',
                    relationship: '',
                    birthYear: '',
                    birthMonth: '',
                    traits: [],
                    emotions: [],
                    habit: '',
                    lifeStory: '',
                    memories: [],
                    personalImpact: '',
                    familyImpact: '',
                    values: [],
                    legacy: '',
                    photos: [],
                    createdAt: null,
                    updatedAt: null,
                    completed: false
                };
                
                this.init();
            }
            
            init() {
                this.bindElements();
                this.initEventListeners();
                this.updateWizardProgress();
                this.loadSavedProgress();
            }
            
            bindElements() {
                this.elements = {
                    avatarDisplay: document.getElementById('avatarDisplay'),
                    avatarOptions: document.getElementById('avatarOptions'),
                    characterName: document.getElementById('characterName'),
                    relationshipOther: document.getElementById('relationshipOther'),
                    birthYear: document.getElementById('birthYear'),
                    birthMonth: document.getElementById('birthMonth'),
                    traitSelector: document.getElementById('traitSelector'),
                    customTrait: document.getElementById('customTrait'),
                    habit: document.getElementById('habit'),
                    lifeStory: document.getElementById('lifeStory'),
                    personalImpact: document.getElementById('personalImpact'),
                    familyImpact: document.getElementById('familyImpact'),
                    legacy: document.getElementById('legacy'),
                    characterPreview: document.getElementById('characterPreview'),
                    previewAvatar: document.getElementById('previewAvatar'),
                    previewName: document.getElementById('previewName'),
                    previewRelationship: document.getElementById('previewRelationship'),
                    previewAge: document.getElementById('previewAge'),
                    previewTraits: document.getElementById('previewTraits'),
                    previewStory: document.getElementById('previewStory'),
                    previewLegacy: document.getElementById('previewLegacy'),
                    traitCount: document.getElementById('traitCount'),
                    storyLength: document.getElementById('storyLength'),
                    valueCount: document.getElementById('valueCount'),
                    completionRate: document.getElementById('completionRate')
                };
            }
            
            initEventListeners() {
                // å¤´åƒé€‰æ‹©
                this.elements.avatarDisplay.addEventListener('click', () => this.showAvatarOptions());
                document.querySelectorAll('.avatar-option').forEach(option => {
                    option.addEventListener('click', (e) => this.selectAvatar(e.target.getAttribute('data-avatar')));
                });
                
                // å…³ç³»é€‰æ‹©
                document.querySelectorAll('.relationship-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const relationship = e.currentTarget.getAttribute('data-relationship');
                        this.selectRelationship(relationship);
                    });
                });
                
                // ç‰¹è´¨é€‰æ‹©
                document.querySelectorAll('.trait-badge').forEach(badge => {
                    if (badge.getAttribute('data-trait')) {
                        badge.addEventListener('click', (e) => this.toggleTrait(e.currentTarget));
                    }
                });
                
                // æƒ…æ„Ÿé€‰æ‹©
                document.querySelectorAll('.emotion-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const emotion = e.currentTarget.getAttribute('data-emotion');
                        this.selectEmotion(emotion, e.currentTarget);
                    });
                });
                
                // ä»·å€¼è§‚é€‰æ‹©
                document.querySelectorAll('.trait-badge[data-value]').forEach(badge => {
                    badge.addEventListener('click', (e) => {
                        const value = e.currentTarget.getAttribute('data-value');
                        this.toggleValue(value, e.currentTarget);
                    });
                });
                
                // è¡¨å•è¾“å…¥ç›‘å¬
                this.elements.characterName.addEventListener('input', (e) => {
                    this.explorationData.name = e.target.value;
                    this.updatePreview();
                });
                
                this.elements.habit.addEventListener('input', (e) => {
                    this.explorationData.habit = e.target.value;
                });
                
                this.elements.lifeStory.addEventListener('input', (e) => {
                    this.explorationData.lifeStory = e.target.value;
                    this.updatePreview();
                });
                
                this.elements.personalImpact.addEventListener('input', (e) => {
                    this.explorationData.personalImpact = e.target.value;
                });
                
                this.elements.familyImpact.addEventListener('input', (e) => {
                    this.explorationData.familyImpact = e.target.value;
                });
                
                this.elements.legacy.addEventListener('input', (e) => {
                    this.explorationData.legacy = e.target.value;
                    this.updatePreview();
                });
                
                // ç…§ç‰‡ä¸Šä¼ 
                document.getElementById('storyPhoto').addEventListener('change', (e) => this.handlePhotoUpload(e));
            }
            
            showAvatarOptions() {
                const options = this.elements.avatarOptions;
                options.style.display = options.style.display === 'none' ? 'flex' : 'none';
            }
            
            selectAvatar(avatar) {
                this.explorationData.avatar = avatar;
                this.elements.avatarDisplay.innerHTML = avatar;
                this.elements.previewAvatar.innerHTML = avatar;
                
                // æ›´æ–°å¤´åƒé€‰é¡¹é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.avatar-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.getAttribute('data-avatar') === avatar) {
                        option.classList.add('active');
                    }
                });
                
                this.showAvatarOptions();
            }
            
            selectRelationship(relationship) {
                this.explorationData.relationship = relationship;
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.relationship-card').forEach(card => {
                    card.classList.remove('selected');
                    if (card.getAttribute('data-relationship') === relationship) {
                        card.classList.add('selected');
                    }
                });
                
                // æ˜¾ç¤º/éšè—å…¶ä»–å…³ç³»è¾“å…¥æ¡†
                this.elements.relationshipOther.style.display = relationship === 'å…¶ä»–' ? 'block' : 'none';
                this.updatePreview();
            }
            
            toggleTrait(badge) {
                const trait = badge.getAttribute('data-trait');
                const index = this.explorationData.traits.indexOf(trait);
                
                if (index === -1) {
                    this.explorationData.traits.push(trait);
                    badge.classList.add('selected');
                } else {
                    this.explorationData.traits.splice(index, 1);
                    badge.classList.remove('selected');
                }
                
                this.updatePreview();
            }
            
            selectEmotion(emotion, card) {
                this.explorationData.emotions = [emotion]; // ç›®å‰å•é€‰ï¼Œå¯æ”¹ä¸ºå¤šé€‰
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.emotion-card').forEach(c => {
                    c.classList.remove('selected');
                });
                card.classList.add('selected');
            }
            
            toggleValue(value, badge) {
                const index = this.explorationData.values.indexOf(value);
                
                if (index === -1) {
                    this.explorationData.values.push(value);
                    badge.classList.add('selected');
                } else {
                    this.explorationData.values.splice(index, 1);
                    badge.classList.remove('selected');
                }
                
                this.updatePreview();
            }
            
            handleTraitKeypress(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const customTrait = this.elements.customTrait.value.trim();
                    
                    if (customTrait && !this.explorationData.traits.includes(customTrait)) {
                        // åˆ›å»ºæ–°çš„ç‰¹è´¨å¾½ç« 
                        const badge = document.createElement('div');
                        badge.className = 'trait-badge';
                        badge.textContent = customTrait;
                        badge.setAttribute('data-trait', customTrait);
                        badge.addEventListener('click', (e) => this.toggleTrait(e.currentTarget));
                        
                        this.elements.traitSelector.appendChild(badge);
                        this.explorationData.traits.push(customTrait);
                        this.elements.customTrait.value = '';
                        
                        this.updatePreview();
                    }
                }
            }
            
            handlePhotoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('image/')) {
                    alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const photoData = {
                        id: Date.now(),
                        data: e.target.result,
                        name: file.name,
                        uploadTime: new Date().toISOString()
                    };
                    
                    this.explorationData.photos.push(photoData);
                    
                    // æ˜¾ç¤ºé¢„è§ˆ
                    const previewDiv = document.getElementById('photoPreview');
                    previewDiv.style.display = 'block';
                    previewDiv.innerHTML = `
                        <div class="flex items-center">
                            <img src="${photoData.data}" alt="é¢„è§ˆ" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
                            <div class="ml-4">
                                <p class="font-medium">${photoData.name}</p>
                                <p class="text-sm text-gray-600">å·²ä¸Šä¼ </p>
                            </div>
                        </div>
                    `;
                };
                
                reader.readAsDataURL(file);
            }
            
            nextStep(step) {
                // éªŒè¯å½“å‰æ­¥éª¤
                if (!this.validateStep(this.currentStep)) {
                    this.showAlert('è¯·å…ˆå®Œæˆå½“å‰æ­¥éª¤çš„å¿…è¦ä¿¡æ¯', 'warning');
                    return;
                }
                
                // éšè—å½“å‰æ­¥éª¤
                document.getElementById(`step${this.currentStep}`).classList.remove('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.remove('active', 'completed');
                
                // æ˜¾ç¤ºä¸‹ä¸€æ­¥éª¤
                this.currentStep = step;
                document.getElementById(`step${this.currentStep}`).classList.add('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.add('active');
                
                // æ ‡è®°ä¸Šä¸€æ­¥ä¸ºå®Œæˆ
                document.querySelector(`.wizard-step[data-step="${this.currentStep - 1}"]`).classList.add('completed');
                
                this.updateWizardProgress();
                
                // å¦‚æœæ˜¯æœ€åä¸€æ­¥ï¼Œæ›´æ–°é¢„è§ˆ
                if (this.currentStep === 5) {
                    this.updatePreview();
                    this.updateStatistics();
                    this.elements.characterPreview.style.display = 'block';
                }
            }
            
            prevStep(step) {
                // éšè—å½“å‰æ­¥éª¤
                document.getElementById(`step${this.currentStep}`).classList.remove('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.remove('active');
                
                // æ˜¾ç¤ºä¸Šä¸€æ­¥éª¤
                this.currentStep = step;
                document.getElementById(`step${this.currentStep}`).classList.add('active');
                document.querySelector(`.wizard-step[data-step="${this.currentStep}"]`).classList.add('active');
                
                this.updateWizardProgress();
                
                // éšè—é¢„è§ˆ
                if (this.currentStep !== 5) {
                    this.elements.characterPreview.style.display = 'none';
                }
            }
            
            validateStep(step) {
                switch(step) {
                    case 1:
                        if (!this.explorationData.name.trim()) {
                            this.showAlert('è¯·å¡«å†™è§’è‰²å§“å', 'warning');
                            return false;
                        }
                        if (!this.explorationData.relationship) {
                            this.showAlert('è¯·é€‰æ‹©ä¸æ‚¨çš„å…³ç³»', 'warning');
                            return false;
                        }
                        break;
                    case 2:
                        if (this.explorationData.traits.length === 0) {
                            this.showAlert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ€§æ ¼ç‰¹è´¨', 'warning');
                            return false;
                        }
                        break;
                    case 3:
                        if (!this.explorationData.lifeStory.trim()) {
                            this.showAlert('è¯·å¡«å†™äººç”Ÿæ•…äº‹', 'warning');
                            return false;
                        }
                        break;
                    case 4:
                        if (!this.explorationData.personalImpact.trim()) {
                            this.showAlert('è¯·å¡«å†™å¯¹æ‚¨çš„ä¸ªäººå½±å“', 'warning');
                            return false;
                        }
                        break;
                }
                return true;
            }
            
            updateWizardProgress() {
                // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                const steps = document.querySelectorAll('.wizard-step');
                steps.forEach((step, index) => {
                    const stepNum = parseInt(step.getAttribute('data-step'));
                    if (stepNum < this.currentStep) {
                        step.classList.add('completed');
                    } else if (stepNum === this.currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }
            
            updatePreview() {
                // æ›´æ–°åŸºæœ¬ä¿¡æ¯
                this.elements.previewName.textContent = this.explorationData.name || 'æœªå‘½å';
                this.elements.previewRelationship.textContent = this.explorationData.relationship || 'æœªçŸ¥å…³ç³»';
                
                // æ›´æ–°å¹´é¾„/å¹´ä»£ä¿¡æ¯
                if (this.explorationData.birthYear) {
                    const age = new Date().getFullYear() - parseInt(this.explorationData.birthYear);
                    this.elements.previewAge.textContent = `çº¦ ${age} å²`;
                } else {
                    this.elements.previewAge.textContent = 'å¹´ä»£ä¸è¯¦';
                }
                
                // æ›´æ–°ç‰¹è´¨
                this.elements.previewTraits.innerHTML = '';
                this.explorationData.traits.forEach(trait => {
                    const traitSpan = document.createElement('span');
                    traitSpan.className = 'preview-trait';
                    traitSpan.textContent = trait;
                    this.elements.previewTraits.appendChild(traitSpan);
                });
                
                // æ›´æ–°æ•…äº‹é¢„è§ˆï¼ˆæˆªå–å‰150å­—ï¼‰
                if (this.explorationData.lifeStory) {
                    const previewText = this.explorationData.lifeStory.length > 150 
                        ? this.explorationData.lifeStory.substring(0, 150) + '...' 
                        : this.explorationData.lifeStory;
                    this.elements.previewStory.textContent = previewText;
                } else {
                    this.elements.previewStory.textContent = 'æš‚æ— æ•…äº‹æè¿°';
                }
                
                // æ›´æ–°ä¼ æ‰¿é¢„è§ˆ
                if (this.explorationData.legacy) {
                    const legacyText = this.explorationData.legacy.length > 100
                        ? this.explorationData.legacy.substring(0, 100) + '...'
                        : this.explorationData.legacy;
                    this.elements.previewLegacy.textContent = legacyText;
                } else {
                    this.elements.previewLegacy.textContent = 'ç­‰å¾…æ‚¨æ¥è®°å½•...';
                }
            }
            
            updateStatistics() {
                // ç‰¹è´¨æ•°é‡
                this.elements.traitCount.textContent = this.explorationData.traits.length;
                
                // æ•…äº‹å­—æ•°
                const storyLength = this.explorationData.lifeStory.length;
                this.elements.storyLength.textContent = storyLength;
                
                // ä¼ æ‰¿ä»·å€¼æ•°é‡
                const valueCount = this.explorationData.values.length + 
                                 (this.explorationData.legacy ? 1 : 0) +
                                 (this.explorationData.personalImpact ? 1 : 0) +
                                 (this.explorationData.familyImpact ? 1 : 0);
                this.elements.valueCount.textContent = valueCount;
                
                // å®Œæˆåº¦è®¡ç®—
                let completionScore = 0;
                if (this.explorationData.name) completionScore += 20;
                if (this.explorationData.relationship) completionScore += 15;
                if (this.explorationData.traits.length > 0) completionScore += 15;
                if (this.explorationData.lifeStory) completionScore += 25;
                if (this.explorationData.personalImpact) completionScore += 15;
                if (this.explorationData.legacy) completionScore += 10;
                
                this.elements.completionRate.textContent = completionScore + '%';
            }
            
            saveExploration() {
                // æ”¶é›†æ‰€æœ‰æ•°æ®
                this.collectFormData();
                
                // éªŒè¯å¿…è¦æ•°æ®
                if (!this.validateStep(1) || !this.validateStep(2) || !this.validateStep(3) || !this.validateStep(4)) {
                    this.showAlert('è¯·å…ˆå®Œæˆæ‰€æœ‰å¿…è¦æ­¥éª¤', 'warning');
                    return;
                }
                
                // è®¾ç½®IDå’Œæ—¶é—´æˆ³
                this.explorationData.id = this.explorationData.id || Date.now();
                this.explorationData.createdAt = this.explorationData.createdAt || new Date().toISOString();
                this.explorationData.updatedAt = new Date().toISOString();
                this.explorationData.completed = true;
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                try {
                    let explorations = JSON.parse(localStorage.getItem('characterExplorations_v1') || '[]');
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆæ›´æ–°ï¼‰
                    const existingIndex = explorations.findIndex(e => e.id === this.explorationData.id);
                    if (existingIndex !== -1) {
                        explorations[existingIndex] = this.explorationData;
                    } else {
                        explorations.push(this.explorationData);
                    }
                    
                    localStorage.setItem('characterExplorations_v1', JSON.stringify(explorations));
                    
                    this.showAlert('è§’è‰²æ¢ç´¢å·²ä¿å­˜ï¼', 'success');
                    
                    // è‡ªåŠ¨è·³è½¬åˆ°ä»ªè¡¨æ¿æˆ–ä¿æŒå½“å‰é¡µé¢
                    setTimeout(() => {
                        const shouldGoToDashboard = confirm('ä¿å­˜æˆåŠŸï¼æ˜¯å¦å‰å¾€ä»ªè¡¨æ¿æŸ¥çœ‹æ‰€æœ‰è®°å½•ï¼Ÿ');
                        if (shouldGoToDashboard) {
                            window.location.href = '../dashboard.html';
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('ä¿å­˜å¤±è´¥:', error);
                    this.showAlert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            }
            
            collectFormData() {
                // åŸºæœ¬ä¿¡æ¯
                this.explorationData.name = this.elements.characterName.value;
                this.explorationData.birthYear = this.elements.birthYear.value;
                this.explorationData.birthMonth = this.elements.birthMonth.value;
                
                // æ€§æ ¼ç‰¹ç‚¹
                this.explorationData.habit = this.elements.habit.value;
                
                // äººç”Ÿæ•…äº‹
                this.explorationData.lifeStory = this.elements.lifeStory.value;
                
                // å½±å“å¯ç¤º
                this.explorationData.personalImpact = this.elements.personalImpact.value;
                this.explorationData.familyImpact = this.elements.familyImpact.value;
                this.explorationData.legacy = this.elements.legacy.value;
                
                // è‡ªå®šä¹‰ä»·å€¼è§‚
                const customValues = document.getElementById('customValues').value;
                if (customValues.trim()) {
                    this.explorationData.values.push(customValues.trim());
                }
            }
            
            loadSavedProgress() {
                try {
                    const savedData = localStorage.getItem('currentCharacterExploration');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        Object.assign(this.explorationData, data);
                        
                        // æ¢å¤è¡¨å•çŠ¶æ€
                        this.restoreFormState();
                        this.updatePreview();
                        
                        console.log('å·²æ¢å¤ä¿å­˜çš„è¿›åº¦');
                    }
                } catch (error) {
                    console.error('æ¢å¤è¿›åº¦å¤±è´¥:', error);
                }
            }
            
            restoreFormState() {
                // æ¢å¤å¤´åƒ
                if (this.explorationData.avatar) {
                    this.selectAvatar(this.explorationData.avatar);
                }
                
                // æ¢å¤å§“å
                if (this.explorationData.name) {
                    this.elements.characterName.value = this.explorationData.name;
                }
                
                // æ¢å¤å…³ç³»
                if (this.explorationData.relationship) {
                    this.selectRelationship(this.explorationData.relationship);
                }
                
                // æ¢å¤ç‰¹è´¨
                if (this.explorationData.traits.length > 0) {
                    this.explorationData.traits.forEach(trait => {
                        const badge = document.querySelector(`.trait-badge[data-trait="${trait}"]`);
                        if (badge) {
                            badge.classList.add('selected');
                        }
                    });
                }
                
                // æ¢å¤æ•…äº‹
                if (this.explorationData.lifeStory) {
                    this.elements.lifeStory.value = this.explorationData.lifeStory;
                }
            }
            
            exportExploration() {
                this.collectFormData();
                
                const exportData = {
                    title: 'å®¶æ—è§’è‰²æ¢ç´¢æŠ¥å‘Š',
                    exportDate: new Date().toLocaleString('zh-CN'),
                    characterName: this.explorationData.name,
                    relationship: this.explorationData.relationship,
                    birthInfo: `${this.explorationData.birthYear || 'æœªçŸ¥'}å¹´${this.explorationData.birthMonth || 'æœªçŸ¥'}æœˆ`,
                    
                    traits: this.explorationData.traits,
                    habit: this.explorationData.habit,
                    emotions: this.explorationData.emotions,
                    
                    lifeStory: this.explorationData.lifeStory,
                    personalImpact: this.explorationData.personalImpact,
                    familyImpact: this.explorationData.familyImpact,
                    values: this.explorationData.values,
                    legacy: this.explorationData.legacy,
                    
                    statistics: {
                        traitsCount: this.explorationData.traits.length,
                        storyLength: this.explorationData.lifeStory.length,
                        valuesCount: this.explorationData.values.length
                    }
                };
                
                // å¯¼å‡ºä¸ºJSON
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                    type: 'application/json' 
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `è§’è‰²æ¢ç´¢æŠ¥å‘Š_${this.explorationData.name || 'æœªå‘½å'}_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showAlert('æŠ¥å‘Šå·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼', 'success');
            }
            
            shareExploration() {
                if (!this.explorationData.name || !this.explorationData.lifeStory) {
                    this.showAlert('è¯·å…ˆå®Œæˆè§’è‰²æ¢ç´¢', 'warning');
                    return;
                }
                
                const shareText = `æˆ‘å‘ç°äº†ä¸€ä½ç‰¹åˆ«çš„å®¶äººï¼š${this.explorationData.name}ï¼ˆ${this.explorationData.relationship}ï¼‰\n\n` +
                                 `æ€§æ ¼ç‰¹ç‚¹ï¼š${this.explorationData.traits.join('ã€')}\n\n` +
                                 `äººç”Ÿæ•…äº‹ï¼š${this.explorationData.lifeStory.substring(0, 100)}...\n\n` +
                                 `æ¢ç´¢æ›´å¤šå®¶æ—æ•…äº‹ï¼Œè¯·è®¿é—®äººæ–‡èµ‹èƒ½èƒ½åŠ›å¹³å°`;
                
                if (navigator.share) {
                    navigator.share({
                        title: `å®¶æ—æ•…äº‹ï¼š${this.explorationData.name}`,
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    // å¤åˆ¶åˆ°å‰ªè´´æ¿
                    navigator.clipboard.writeText(shareText)
                        .then(() => this.showAlert('åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success'))
                        .catch(() => this.showAlert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error'));
                }
            }
            
            startNewExploration() {
                const confirmReset = confirm('å¼€å§‹æ–°çš„æ¢ç´¢å°†æ¸…ç©ºå½“å‰å†…å®¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ');
                if (!confirmReset) return;
                
                // é‡ç½®æ•°æ®
                this.explorationData = {
                    id: null,
                    avatar: 'ğŸ‘¤',
                    name: '',
                    relationship: '',
                    birthYear: '',
                    birthMonth: '',
                    traits: [],
                    emotions: [],
                    habit: '',
                    lifeStory: '',
                    memories: [],
                    personalImpact: '',
                    familyImpact: '',
                    values: [],
                    legacy: '',
                    photos: [],
                    createdAt: null,
                    updatedAt: null,
                    completed: false
                };
                
                // é‡ç½®è¡¨å•
                this.resetForm();
                
                // è¿”å›ç¬¬ä¸€æ­¥
                this.currentStep = 1;
                document.querySelectorAll('.wizard-step-content').forEach(div => div.classList.remove('active'));
                document.getElementById('step1').classList.add('active');
                
                // é‡ç½®æ­¥éª¤æŒ‡ç¤ºå™¨
                document.querySelectorAll('.wizard-step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });
                document.querySelector('.wizard-step[data-step="1"]').classList.add('active');
                
                this.updateWizardProgress();
                
                // éšè—é¢„è§ˆ
                this.elements.characterPreview.style.display = 'none';
                
                this.showAlert('å·²å¼€å§‹æ–°çš„æ¢ç´¢', 'info');
            }
            
            resetForm() {
                // é‡ç½®æ‰€æœ‰è¡¨å•å…ƒç´ 
                this.elements.avatarDisplay.innerHTML = 'ğŸ‘¤';
                this.elements.characterName.value = '';
                this.elements.birthYear.value = '';
                this.elements.birthMonth.value = '';
                this.elements.habit.value = '';
                this.elements.lifeStory.value = '';
                this.elements.personalImpact.value = '';
                this.elements.familyImpact.value = '';
                this.elements.legacy.value = '';
                document.getElementById('customValues').value = '';
                
                // é‡ç½®é€‰æ‹©çŠ¶æ€
                document.querySelectorAll('.relationship-card').forEach(card => card.classList.remove('selected'));
                document.querySelectorAll('.trait-badge').forEach(badge => badge.classList.remove('selected'));
                document.querySelectorAll('.emotion-card').forEach(card => card.classList.remove('selected'));
                document.querySelectorAll('.trait-badge[data-value]').forEach(badge => badge.classList.remove('selected'));
                
                // é‡ç½®é¢„è§ˆ
                this.updatePreview();
            }
            
            showAlert(message, type = 'info') {
                // ç§»é™¤ç°æœ‰çš„æç¤º
                const existingAlert = document.querySelector('.alert-toast');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // åˆ›å»ºæ–°æç¤º
                const alert = document.createElement('div');
                alert.className = `alert-toast alert-${type} fixed top-4 right-4 z-50 max-w-md`;
                alert.innerHTML = `
                    <div class="flex items-start p-4 rounded-lg shadow-lg animate-slide-in-right">
                        <div class="mr-3 text-lg">${this.getAlertIcon(type)}</div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                        <button class="ml-4 text-gray-400 hover:text-gray-600" onclick="this.parentElement.remove()">
                            &times;
                        </button>
                    </div>
                `;
                
                document.body.appendChild(alert);
                
                // è‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, 3000);
            }
            
            getAlertIcon(type) {
                const icons = {
                    success: 'âœ…',
                    error: 'âŒ',
                    warning: 'âš ï¸',
                    info: 'â„¹ï¸'
                };
                return icons[type] || 'â„¹ï¸';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.characterExplorer = new CharacterExplorer();
            
            // ä¸ºå…¨å±€å‡½æ•°ç»‘å®šå®ä¾‹æ–¹æ³•
            window.nextStep = (step) => window.characterExplorer.nextStep(step);
            window.prevStep = (step) => window.characterExplorer.prevStep(step);
            window.saveExploration = () => window.characterExplorer.saveExploration();
            window.exportExploration = () => window.characterExplorer.exportExploration();
            window.shareExploration = () => window.characterExplorer.shareExploration();
            window.startNewExploration = () => window.characterExplorer.startNewExploration();
            window.showAvatarOptions = () => window.characterExplorer.showAvatarOptions();
            window.handleTraitKeypress = (event) => window.characterExplorer.handleTraitKeypress(event);
            window.addMemory = () => {
                const year = prompt('è¯·è¾“å…¥è®°å¿†å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š1998ï¼‰');
                if (year) {
                    const description = prompt('è¯·æè¿°è¿™ä¸ªè®°å¿†');
                    if (description) {
                        // è¿™é‡Œå¯ä»¥æ·»åŠ è®°å¿†åˆ°æ—¶é—´çº¿
                        alert('è®°å¿†å·²æ·»åŠ ');
                    }
                }
            };
            
            // ä¿å­˜é¡µé¢ç¦»å¼€æ—¶çš„è¿›åº¦
            window.addEventListener('beforeunload', () => {
                window.characterExplorer.collectFormData();
                localStorage.setItem('currentCharacterExploration', JSON.stringify(window.characterExplorer.explorationData));
            });
        });
    </script>
</body>
</html>
